<!DOCTYPE html>
<html lang="kk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    
    <title>Qarjy Pro - Enterprise Edition</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.3.0/exceljs.min.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    
    <style>
        /* =======================================================
           2. CSS: –ì–õ–û–ë–ê–õ–¨–î–´ –ê–ô–ù–´–ú–ê–õ–´–õ–ê–† (VARIABLES)
           =======================================================
        */
        :root {
            --color-primary: #3b82f6;       
            --color-primary-hover: #2563eb; 
            --color-secondary: #1e3a8a;     
            
            --bg-body: #0f172a;            
            --bg-card: #1e293b;             
            --bg-panel: #111827;           
            --bg-input: rgba(30, 41, 59, 0.6); 
            
            --text-main: #ffffff;           
            --text-muted: #94a3b8;        
            
            --color-success: #10b981;       
            --color-danger: #ef4444;        
            --color-warning: #f59e0b;       
            --color-info: #0ea5e9;         
            
            --border-color: #1f2937;       
            --border-radius-lg: 24px;     
            --border-radius-md: 16px;      
            --border-radius-sm: 12px;     
            
            --shadow-sm: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            --shadow-glow: 0 0 15px rgba(59, 130, 246, 0.5);
        }

        /* =======================================================
           3. –ù–ï–ì–Ü–ó–ì–Ü –°–¢–ò–õ–¨–î–ï–† (CORE STYLES)
           =======================================================
        */
        
        * {
            box-sizing: border-box;
        }

        body {
            background-color: var(--bg-body);
            background-image: 
                radial-gradient(at 40% 20%, hsla(228,100%,74%,0.1) 0px, transparent 50%),
                radial-gradient(at 80% 0%, hsla(189,100%,56%,0.1) 0px, transparent 50%),
                radial-gradient(at 0% 50%, hsla(340,100%,76%,0.1) 0px, transparent 50%);
            color: var(--text-main);
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            min-height: 100vh;
            overflow-x: hidden; 
            margin: 0;
            padding: 0;
            font-size: 15px;
            line-height: 1.5;
        }

        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: var(--bg-body); 
        }
        ::-webkit-scrollbar-thumb {
            background: #334155; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: var(--color-primary); 
        }

        /* =======================================================
           4. –ê–ù–ò–ú–ê–¶–ò–Ø–õ–ê–† (KEYFRAMES ANIMATIONS)
           =======================================================
        */
        
        @keyframes slideUpFade {
            0% { opacity: 0; transform: translateY(40px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulseGlow {
            0% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(59, 130, 246, 0); }
            100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); }
        }

        .animate-up {
            animation-name: slideUpFade;
            animation-duration: 0.8s;
            animation-timing-function: cubic-bezier(0.16, 1, 0.3, 1);
            animation-fill-mode: forwards;
            opacity: 0; 
        }

        .delay-1 { animation-delay: 0.1s; }
        .delay-2 { animation-delay: 0.2s; }
        .delay-3 { animation-delay: 0.3s; }
        .delay-4 { animation-delay: 0.4s; }
        .delay-5 { animation-delay: 0.5s; }

        /* =======================================================
           5. UI –ö–û–ú–ü–û–ù–ï–ù–¢–¢–ï–†–Ü (COMPONENTS)
           =======================================================
        */

        .header-bar {
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(20px);      
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--border-radius-lg);
            padding: 20px 35px;
            margin-bottom: 30px;
            margin-top: 15px;
            box-shadow: var(--shadow-lg);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
            z-index: 100;
            position: relative;
        }
        
        .header-bar:hover {
            border-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .logo-circle {
            width: 55px;
            height: 55px;
            background: linear-gradient(135deg, var(--color-primary), var(--color-primary-hover));
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            color: white;
            box-shadow: var(--shadow-glow);
            position: relative;
            overflow: hidden;
        }
        
        .logo-circle::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(to bottom right, rgba(255,255,255,0.3), transparent);
            transform: rotate(45deg);
            pointer-events: none;
        }

        .profile-box {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 50px;
            padding: 8px 20px 8px 8px;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: background 0.3s;
            cursor: default;
        }
        
        /* –¢—ñ–∑—ñ–º–Ω—ñ“£ (Select) —Å–∫—Ä–æ–ª–ª—ã–Ω ”ô–¥–µ–º—ñ–ª–µ—É */
        select.form-select {
            cursor: pointer;
        }

        /* Chrome, Safari, Edge “Ø—à—ñ–Ω —Å–∫—Ä–æ–ª–ª —Å—Ç–∏–ª—ñ */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(30, 41, 59, 0.5); 
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #475569; 
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--color-primary); 
        }

        /* –ï–≥–µ—Ä –±–æ–ª–∞—à–∞“õ—Ç–∞ Custom Dropdown –∂–∞—Å–∞—Å–∞“£—ã–∑ (“õ–∞–∑—ñ—Ä–≥—ñ Select –æ—Ä–Ω—ã–Ω–∞), –º—ã–Ω–∞–Ω—ã “õ–æ–ª–¥–∞–Ω–∞—Å—ã–∑: */
        .dropdown-menu {
            max-height: 250px;
            overflow-y: auto;
            background-color: var(--bg-card);
            border: 1px solid var(--border-color);
        }
               
        .profile-box:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .user-icon {
            width: 40px;
            height: 40px;
            background: var(--color-primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            color: white;
            border: 2px solid rgba(255,255,255,0.2);
        }

        .form-panel, .custom-panel, .form-auth {
            background: var(--bg-panel);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-lg);
            padding: 30px;
            box-shadow: var(--shadow-md);
            height: 100%;
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
        }

        .form-panel:hover, .custom-panel:hover {
            border-color: #475569;
            box-shadow: var(--shadow-lg);
            transform: translateY(-4px);
        }

        /* =======================================================
           6. –§–û–†–ú–ê –≠–õ–ï–ú–ï–ù–¢–¢–ï–†–Ü (FORMS & INPUTS)
           =======================================================
        */

        .form-control, .form-select {
            background-color: var(--bg-input) !important;
            border: 1px solid #374151;
            color: var(--text-main) !important;
            border-radius: var(--border-radius-sm);
            padding: 12px 15px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-control:focus, .form-select:focus {
            border-color: var(--color-primary);
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.15);
            background-color: var(--bg-card) !important;
            outline: none;
        }
        
        .form-control::placeholder {
            color: #64748b;
        }

        label.small {
            font-weight: 600;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
            display: block;
            color: var(--text-muted);
            text-transform: uppercase;
            font-size: 0.75rem;
        }

        .btn-add {
            background: linear-gradient(90deg, var(--color-primary), var(--color-primary-hover));
            color: white;
            width: 100%;
            padding: 14px;
            border-radius: var(--border-radius-sm);
            font-weight: 700;
            border: none;
            transition: all 0.3s ease;
            margin-top: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 0.9rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }

        .btn-add:hover {
            box-shadow: 0 10px 25px -5px rgba(37, 99, 235, 0.4);
            transform: translateY(-2px);
            background: linear-gradient(90deg, var(--color-primary-hover), var(--color-primary));
        }
        
        .btn-add:active {
            transform: translateY(0);
        }


        .type-toggle {
            display: flex;
            background: rgba(30, 41, 59, 0.5);
            padding: 5px;
            border-radius: var(--border-radius-md);
            margin-bottom: 25px;
            border: 1px solid var(--border-color);
        }

        .toggle-btn {
            flex: 1;
            padding: 12px;
            border: none;
            background: transparent;
            color: var(--text-muted);
            font-weight: 600;
            border-radius: 10px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .toggle-btn:hover {
            color: white;
            background: rgba(255,255,255,0.05);
        }

        .toggle-btn.active-expense {
            background: var(--color-danger);
            color: white;
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }

        .toggle-btn.active-income {
            background: var(--color-success);
            color: white;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        /* =======================================================
           7. –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ö–ê–†–¢–û–ß–ö–ê–õ–ê–†–´ (STAT CARDS)
           =======================================================
        */
        
        .stat-card {
            background: var(--bg-card);
            border-radius: var(--border-radius-md);
            padding: 25px;
            height: 100%;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(to bottom, rgba(255,255,255,0.03), transparent);
            pointer-events: none;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
            border-color: #475569;
            z-index: 5;
        }

        .card-green { border-bottom: 4px solid var(--color-success); }
        .card-red { border-bottom: 4px solid var(--color-danger); }
        .card-blue { border-bottom: 4px solid var(--color-primary); }

        .stat-card h3 {
            font-size: 2rem;
            margin-top: 15px;
            letter-spacing: -0.5px;
            color: var(--text-main);
        }

        /* =======================================================
           8. –¢–†–ê–ù–ó–ê–ö–¶–ò–Ø–õ–ê–† –¢–Ü–ó–Ü–ú–Ü (TRANSACTION LIST)
           =======================================================
        */
        
        .tx-item {
            background: rgba(30, 41, 59, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: var(--border-radius-md);
            padding: 16px 20px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s ease;
            animation: slideUpFade 0.5s ease-out forwards;
            opacity: 0;
            position: relative;
        }

        .tx-item:hover {
            background: rgba(30, 41, 59, 0.8);
            border-color: rgba(255, 255, 255, 0.15);
            transform: scale(1.01);
        }

        .tx-icon {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            margin-right: 15px;
            flex-shrink: 0;
        }

        .icon-exp { background: rgba(239, 68, 68, 0.15); color: var(--color-danger); }
        .icon-inc { background: rgba(16, 185, 129, 0.15); color: var(--color-success); }

        .tx-info {
            flex-grow: 1;
            overflow: hidden;
        }

        .tx-cat {
            font-weight: 700;
            font-size: 1rem;
            color: #e2e8f0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .tx-date {
            color: #64748b;
            font-size: 0.85rem;
            margin-top: 2px;
        }

        .tx-amount-group {
            text-align: right;
            min-width: 100px;
            display: flex;
            align-items: center;
        }

        .tx-amt {
            font-weight: 800;
            font-size: 1.1rem;
            display: block;
            margin-right: 15px;
        }

        .text-red { color: var(--color-danger); }
        .text-green { color: var(--color-success); }

        .btn-del {
            background: transparent;
            border: none;
            color: #475569;
            font-size: 1.1rem;
            cursor: pointer;
            transition: color 0.3s;
            padding: 5px;
        }

        .btn-del:hover {
            color: var(--color-danger);
        }

        /* =======================================================
           9. –ë–Æ–î–ñ–ï–¢ –ñ”ò–ù–ï –õ–û–ì–ò–ù –≠–õ–ï–ú–ï–ù–¢–¢–ï–†–Ü
           =======================================================
        */
        
        .budget-item {
            padding: 20px 0;
            border-bottom: 1px solid var(--border-color);
        }
        
        .budget-item:last-child {
            border-bottom: none;
        }

        .progress {
            height: 12px;
            background-color: #334155;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: inset 0 1px 2px rgba(0,0,0,0.2);
            margin-top: 8px;
        }

        .progress-bar {
            border-radius: 10px;
            transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);
            background-image: linear-gradient(45deg,rgba(255,255,255,.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,.15) 50%,rgba(255,255,255,.15) 75%,transparent 75%,transparent);
            background-size: 1rem 1rem;
        }


        .login-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 100%); /* “ö–æ—é –∫”©–∫ —Ñ–æ–Ω */
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
        }


        .auth-card {
            background: rgba(30, 41, 59, 0.7); 
            backdrop-filter: blur(15px);       
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            padding: 40px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            text-align: center;
            animation: slideUpFade 0.6s ease-out;
        }


        .auth-logo {
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            border-radius: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: white;
            margin: 0 auto 20px;
            box-shadow: 0 10px 20px rgba(59, 130, 246, 0.3);
        }


        .auth-input {
            background-color: rgba(15, 23, 42, 0.6) !important;
            border: 1px solid #334155;
            color: white !important;
            border-radius: 12px;
            padding: 12px 15px;
            font-size: 1rem;
            transition: 0.3s;
        }
        .auth-input:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
            outline: none;
        }


        .btn-auth {
            background: linear-gradient(90deg, #3b82f6, #2563eb);
            color: white;
            border: none;
            padding: 14px;
            width: 100%;
            border-radius: 12px;
            font-weight: bold;
            margin-top: 20px;
            font-size: 1rem;
            transition: 0.3s;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }
        .btn-auth:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.5);
        }

        /* =======================================================
           10. –ù–ê–í–ò–ì–ê–¶–ò–Ø –ñ”ò–ù–ï –§–ò–õ–¨–¢–†–õ–ï–† (TAB & FILTER)
           =======================================================
        */


        .nav-container {
            display: flex;
            justify-content: center;
            margin-bottom: 25px;
        }
        
        .nav-toggle {
            background: var(--bg-panel);
            border: 1px solid var(--border-color);
            border-radius: 50px;
            padding: 5px;
            display: flex;
            width: 100%;
            max-width: 500px;
            box-shadow: var(--shadow-sm);
        }

        .tab-btn {
            flex: 1;
            border: none;
            background: transparent;
            color: var(--text-muted);
            padding: 10px;
            border-radius: 40px;
            font-weight: 600;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .tab-btn.active {
            background: var(--color-primary);
            color: white;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
        }


        .filter-btn-group {
            background: var(--bg-panel);
            border-radius: 50px;
            padding: 5px;
            border: 1px solid var(--border-color);
            display: inline-flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 5px;
        }

        .filter-btn {
            border: none;
            background: transparent;
            color: var(--text-muted);
            padding: 8px 20px;
            border-radius: 40px;
            font-weight: 600;
            transition: 0.3s;
            cursor: pointer;
        }

        .filter-btn.active {
            background: var(--color-primary);
            color: white;
            box-shadow: 0 2px 10px rgba(59, 130, 246, 0.4);
        }


        .modal-content {
            background-color: var(--bg-card);
            color: white;
            border: 1px solid var(--border-color);
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }
        
        .modal-header {
            border-bottom: 1px solid var(--border-color);
        }
        
        .modal-footer {
            border-top: 1px solid var(--border-color);
        }
        
        .btn-close-white {
            filter: invert(1) grayscale(100%) brightness(200%);
        }

        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }

        @media (max-width: 768px) {
    /* 1. HEADER –ö–û–ù–¢–ï–ô–ù–ï–† */
    .header-bar {
        display: flex !important;
        flex-direction: row !important; /* “ö–∞—Ç–∞—Ä —Ç“±—Ä—Å—ã–Ω */
        align-items: center !important; /* –û—Ä—Ç–∞—Å—ã–Ω–∞ –∫–µ–ª—Ç—ñ—Ä—É */
        justify-content: space-between !important; /* –ï–∫—ñ —à–µ—Ç–∫–µ –∏—Ç–µ—Ä—É */
        padding: 10px 15px !important;
        height: auto !important;
        background: rgba(30, 41, 59, 0.95) !important; /* –°”ô–ª “õ–æ—é —Ñ–æ–Ω */
        margin-bottom: 20px !important;
        border-radius: 0 0 20px 20px !important; /* –ê—Å—Ç—ã“£“ì—ã –±“±—Ä—ã—à—Ç–∞—Ä—ã–Ω –¥”©“£–≥–µ–ª–µ—Ç—É */
    }

    /* 2. –õ–û–ì–û–¢–ò–ü –ñ”ò–ù–ï –ê–¢–´ (–°–æ–ª –∂–∞“õ) */
    /* –û–ª–∞—Ä–¥—ã –±—ñ—Ä “õ–∞—Ç–∞—Ä“ì–∞, —Ç“Ø–∑—É “õ–æ—é */
    .header-bar > div:first-child {
        display: flex !important;
        align-items: center !important;
        gap: 10px !important;
    }

    .logo-circle {
        width: 40px !important;
        height: 40px !important;
        font-size: 1.2rem !important;
        margin-bottom: 0 !important;
    }

    .header-bar h4 {
        font-size: 1.2rem !important;
        margin: 0 !important;
        line-height: 1 !important;
        display: block !important;
    }
    
    /* "–ö”ô—Å—ñ–±–∏ “õ–∞—Ä–∂—ã–ª—ã“õ –±–∞“õ—ã–ª–∞—É" –¥–µ–≥–µ–Ω “±—Å–∞“õ –∂–∞–∑—É–¥—ã –∂–∞—Å—ã—Ä–∞–º—ã–∑ (–æ—Ä—ã–Ω –∞–ª–º–∞—Å “Ø—à—ñ–Ω) */
    .header-bar small {
        display: none !important;
    }

    /* 3. –ü–†–û–§–ò–õ–¨ –ñ”ò–ù–ï –ë–ê–¢–´–†–ú–ê–õ–ê–† (–û“£ –∂–∞“õ) */
    .header-bar > div:last-child {
        display: flex !important;
        align-items: center !important;
        gap: 8px !important;
    }

    /* –ü–†–û–§–ò–õ–¨–î–Ü “ö–ê–ô–¢–ê–†–£ */
    .profile-box {
        display: flex !important; /* –ñ–∞—Å—ã—Ä—ã–Ω –∫–ª–∞—Å—Ç—ã –±“±–∑—É */
        padding: 0 !important;
        border: none !important;
        background: transparent !important;
        margin-right: 5px !important;
    }
    
    /* –¢–µ–∫ –∞–≤–∞—Ç–∞—Ä “õ–∞–ª–∞–¥—ã, –∞—Ç—ã-–∂”©–Ω—ñ–Ω –∂–∞—Å—ã—Ä–∞–º—ã–∑ (—Ç–µ–ª–µ—Ñ–æ–Ω“ì–∞ —Å—ã–π–º–∞–π–¥—ã) */
    .profile-box .text-start {
        display: none !important; 
    }
    
    .user-icon {
        width: 35px !important;
        height: 35px !important;
        border: 2px solid var(--color-primary) !important;
    }

    /* –ë–ê–¢–´–†–ú–ê–õ–ê–†–î–´ (Excel, –õ–∏–º–∏—Ç) –´“ö–®–ê–ú–î–ê–£ */
    .header-bar .btn {
        width: 35px !important;
        height: 35px !important;
        padding: 0 !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        border-radius: 10px !important;
    }
    
    /* –ë–∞—Ç—ã—Ä–º–∞ —ñ—à—ñ–Ω–¥–µ–≥—ñ –∂–∞–∑—É–¥—ã –∞–ª—ã–ø —Ç–∞—Å—Ç–∞–π–º—ã–∑, —Ç–µ–∫ –∏–∫–æ–Ω–∫–∞ “õ–∞–ª–∞–¥—ã */
    .header-bar .btn i { margin: 0 !important; }
    .header-bar .btn { font-size: 0 !important; } /* –¢–µ–∫—Å—Ç—Ç—ñ –∂–∞—Å—ã—Ä—É */
    .header-bar .btn i { font-size: 1rem !important; } /* –ò–∫–æ–Ω–∫–∞–Ω—ã “õ–∞–π—Ç–∞ –∫”©—Ä—Å–µ—Ç—É */
}
    </style>
</head>
<body>

    <div id="auth-screen" class="login-overlay">
        <div class="auth-card">
            <div class="auth-logo">
                <i class="fas fa-wallet"></i>
            </div>
            
            <h3 class="fw-bold text-white mb-1" id="auth-title">“ö–æ—à –∫–µ–ª–¥—ñ“£—ñ–∑!</h3>
            <p class="text-white-50 mb-4 small">“ö–∞—Ä–∂—ã–ª—ã“õ –µ—Ä–∫—ñ–Ω–¥—ñ–∫–∫–µ “õ–∞–¥–∞–º</p>
            
            <div id="register-fields" style="display: none;">
                <div class="mb-3 text-start">
                    <label class="small text-muted mb-1 ps-1">–ê—Ç—ã“£—ã–∑</label>
                    <input type="text" class="form-control auth-input" id="reg-username" placeholder="–ï—Å—ñ–º—ñ“£—ñ–∑">
                </div>
            </div>
            
            <div class="mb-3 text-start">
                <label class="small text-muted mb-1 ps-1">Email</label>
                <input type="email" class="form-control auth-input" id="auth-email" placeholder="name@example.com" value="">
            </div>
            
            <div class="mb-3 text-start">
                <label class="small text-muted mb-1 ps-1">“ö“±–ø–∏—è —Å”©–∑</label>
                <input type="password" class="form-control auth-input" id="auth-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢   " value="">
            </div>

            <div id="confirm-pass-group" style="display: none;">
                <div class="mb-4 text-start">
                    <label class="small text-muted mb-1 ps-1">–ü–∞—Ä–æ–ª—å–¥—ñ —Ä–∞—Å—Ç–∞—É</label>
                    <input type="password" class="form-control auth-input" id="reg-confirm-password" placeholder="–ü–∞—Ä–æ–ª—å–¥—ñ “õ–∞–π—Ç–∞–ª–∞“£—ã–∑">
                      
                </div>
            </div>
            
            <button onclick="handleAuth()" class="btn-auth" id="auth-btn">
                –ö–Ü–†–£ <i class="fas fa-arrow-right ms-2"></i>
            </button>
            
            <div class="mt-4 text-white-50 small">
                <span id="auth-switch-text">–ê–∫–∫–∞—É–Ω—Ç—ã“£—ã–∑ –∂–æ“õ –ø–∞?</span>
                <span class="text-primary fw-bold ms-1" style="cursor: pointer; text-decoration: underline;" onclick="toggleAuthMode()">–¢—ñ—Ä–∫–µ–ª—É</span>
            </div>
            
            <div id="error-msg" class="alert alert-danger mt-3 py-2 small fw-bold" style="display:none; background: rgba(239, 68, 68, 0.1); border-color: #ef4444; color: #fca5a5;"></div>
        </div>
    </div>

    <div id="app-screen" class="container-fluid px-4" style="display: none; max-width: 1600px;">
        
        <div class="header-bar animate-up">
    <div class="d-flex align-items-center gap-3">
        <div class="logo-circle"><i class="fas fa-wallet"></i></div> 
        <div>
            <h4 class="fw-bold m-0">Qarjy Pro</h4>
            <small class="text-secondary">–ö”ô—Å—ñ–±–∏ “õ–∞—Ä–∂—ã–ª—ã“õ –±–∞“õ—ã–ª–∞—É</small>
        </div>
    </div>
    
    <div class="d-flex align-items-center gap-3">
        <div class="profile-box d-flex" onclick="openProfileModal()" style="cursor: pointer;">
            <div class="user-icon"><i class="fas fa-user"></i></div>
            <div class="text-start d-none d-md-block"> 
                <div class="fw-bold small lh-1" id="header-user-name">User</div>
                <div class="small text-secondary lh-1 mt-1" id="header-user-email">...</div>
            </div>
        </div>

        <button onclick="openBudgetModal()" class="btn btn-warning btn-sm rounded-pill px-3 me-1 fw-bold text-white shadow-sm" title="–õ–∏–º–∏—Ç “õ–æ—é">
            <i class="fas fa-coins me-1"></i> –õ–∏–º–∏—Ç
        </button>

        <button onclick="openExcelModal()" class="btn btn-success btn-sm rounded-pill px-3 me-1 shadow-sm" title="Excel-–≥–µ –∂“Ø–∫—Ç–µ—É">
            <i class="fas fa-file-excel me-1"></i> Excel
        </button>
        
        </div>
</div>  
        <div class="d-flex justify-content-center mb-4 animate-up delay-1">
<div class="filter-btn-group">
                <button onclick="applyFilter('all')" class="filter-btn active" id="btn-filter-all">–ë–∞—Ä–ª—ã“ì—ã</button>
                <button onclick="applyFilter('6months')" class="filter-btn" id="btn-filter-6months">–ñ–∞—Ä—Ç—ã –∂—ã–ª</button>
                <button onclick="applyFilter('3months')" class="filter-btn" id="btn-filter-3months">3 –∞–π</button>
                <button onclick="applyFilter('month')" class="filter-btn" id="btn-filter-month">–û—Å—ã –∞–π</button>
                <button onclick="applyFilter('week')" class="filter-btn" id="btn-filter-week">–ê–ø—Ç–∞</button>
                <button onclick="applyFilter('today')" class="filter-btn" id="btn-filter-today">–ë“Ø–≥—ñ–Ω</button>
            </div>
        </div>

        <div class="row g-4">
            <div class="col-lg-4 animate-up delay-2">
                <div class="form-panel h-100">
                    <h5 class="mb-4 fw-bold d-flex align-items-center">
                        <i class="fas fa-plus-circle me-2 text-primary"></i> –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è “õ–æ—Å—É
                    </h5>
                    
                    <div class="type-toggle">
                        <button id="btn-expense" class="toggle-btn active-expense" onclick="setType('expense')">
                            <i class="fas fa-arrow-circle-down me-2"></i> –®—ã“ì—ã–Ω
                        </button>
                        <button id="btn-income" class="toggle-btn" onclick="setType('income')">
                            <i class="fas fa-arrow-circle-up me-2"></i> –¢”©–ª–µ–º
                        </button>
                    </div>

                    <label class="small text-secondary mb-1 ms-1">–°–æ–º–∞ (‚Ç∏)</label>
                    <div class="input-group mb-3">
                        <span class="input-group-text bg-dark border-secondary text-muted">‚Ç∏</span>
                        <input type="number" id="amount" class="form-control border-start-0" placeholder="0">
                    </div>

                    <div id="expense-cat-wrapper">
                        <label class="small text-secondary mb-1 ms-1">–®—ã“ì—ã–Ω –°–∞–Ω–∞—Ç—ã</label>
                        <select id="expense-cat-id" class="form-select mb-3">
                            <option value="1">üçî –¢–∞–º–∞“õ</option>
                            <option value="2">üöå –ö”©–ª—ñ–∫</option>
                            <option value="3">üõçÔ∏è –°–∞—Ç—ã–ø –∞–ª—É</option>
                            <option value="4">üéÆ –û–π—ã–Ω-—Å–∞—É—ã“õ</option>
                            <option value="5">üí° –ö–æ–º–º—É–Ω–∞–ª–¥—ã“õ</option>
                            <option value="6">üíä –î–µ–Ω—Å–∞—É–ª—ã“õ</option>
                            <option value="7">üéì –ë—ñ–ª—ñ–º</option>
                            <option value="8">‚úàÔ∏è –°–∞—è—Ö–∞—Ç</option>
                            <option value="9">üì¶ –ë–∞—Å“õ–∞</option>
                        </select>
                    </div>

                    <div id="income-cat-wrapper" style="display: none;">
                        <label class="small text-secondary mb-1 ms-1">–¢”©–ª–µ–º –°–∞–Ω–∞—Ç—ã</label>
                        <select id="income-cat-id" class="form-select mb-3">
                            <option value="10">üí∞ –ñ–∞–ª–∞“õ—ã</option>
                            <option value="11">üíª –§—Ä–∏–ª–∞–Ω—Å</option>
                            <option value="12">üìà –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏—è</option>
                            <option value="13">üéÅ –°—ã–π–ª—ã“õ</option>
                            <option value="14">üîÑ “ö–∞–π—Ç–∞—Ä—ã–º</option>
                            <option value="15">üì¶ –ë–∞—Å“õ–∞</option>
                        </select>
                    </div>

                    <label class="small text-secondary mb-1 ms-1">–ö“Ø–Ω—ñ</label>
                    <input type="date" id="date" class="form-control mb-3">

                    <label class="small text-secondary mb-1 ms-1">–°–∏–ø–∞—Ç—Ç–∞–º–∞</label>
                    <textarea id="desc" class="form-control mb-4" rows="3" placeholder="–ú—ã—Å–∞–ª—ã: –¢–∞–∫—Å–∏..."></textarea>

                    <button onclick="addTransaction()" class="btn-add">
                        –°–∞“õ—Ç–∞—É <i class="fas fa-paper-plane ms-2"></i>
                    </button>
                </div>
            </div>

            <div class="col-lg-8 animate-up delay-2">
                
                <div class="nav-container">
                    <div class="nav-toggle">
                        <button class="tab-btn active" onclick="switchTab('dashboard')" id="tab-dashboard">
                            <i class="fas fa-chart-pie me-2"></i> –®–æ–ª—É
                        </button>
                        <button class="tab-btn" onclick="switchTab('transactions')" id="tab-transactions">
                            <i class="fas fa-list me-2"></i> –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–ª–∞—Ä
                        </button>
                        <button class="tab-btn" onclick="switchTab('budget')" id="tab-budget">
                            <i class="fas fa-wallet me-2"></i> –ë—é–¥–∂–µ—Ç
                        </button>
                    </div>
                </div>

                <div id="view-dashboard" class="animate-up delay-3">
                    <div class="row g-3 mb-4">
                        <div class="col-md-4">
                            <div class="stat-card card-green">
                                <div class="d-flex justify-content-between align-items-center">
                                    <small class="text-secondary fw-bold">–¢”®–õ–ï–ú–î–ï–†</small>
                                    <div class="bg-success bg-opacity-25 p-2 rounded-circle">
                                        <i class="fas fa-arrow-up text-success"></i>
                                    </div>
                                </div>
                                <h3 id="total-income" class="mb-0 fw-bold mt-3 text-white">0 ‚Ç∏</h3>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="stat-card card-red">
                                <div class="d-flex justify-content-between align-items-center">
                                    <small class="text-secondary fw-bold">–®–´“í–´–ù–î–ê–†</small>
                                    <div class="bg-danger bg-opacity-25 p-2 rounded-circle">
                                        <i class="fas fa-arrow-down text-danger"></i>
                                    </div>
                                </div>
                                <h3 id="total-expenses" class="mb-0 fw-bold mt-3 text-white">0 ‚Ç∏</h3>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="stat-card card-blue">
                                <div class="d-flex justify-content-between align-items-center">
                                    <small class="text-secondary fw-bold">–ë–ê–õ–ê–ù–°</small>
                                    <div class="bg-primary bg-opacity-25 p-2 rounded-circle">
                                        <i class="fas fa-wallet text-primary"></i>
                                    </div>
                                </div>
                                <h3 id="net-balance" class="mb-0 fw-bold mt-3 text-white">0 ‚Ç∏</h3>
                            </div>
                        </div>
                    </div>
                    
                    <div class="custom-panel p-4 mb-4">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h5 class="mb-0 fw-bold" id="chart-title">–ñ–∞–ª–ø—ã —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–ë–∞—Ä–ª—ã“ì—ã)</h5>
                            <span class="badge bg-dark border border-secondary text-secondary">Analytics</span>
                        </div>
                        <div class="chart-container">
                            <canvas id="barChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="custom-panel p-4">
                        <h5 class="mb-3 fw-bold">–°–∞–Ω–∞—Ç—Ç–∞—Ä –±–æ–π—ã–Ω—à–∞ “Ø–ª–µ—Å—ñ</h5>
                        <div style="position: relative; height: 300px; width: 100%;">
                            <canvas id="doughnutChart"></canvas>
                        </div>
                    </div>
                </div>

                <div id="view-transactions" style="display: none;" class="animate-up delay-3">
                    <div class="row mb-3">
                        <div class="col-md-5">
                            <div class="input-group">
                                <span class="input-group-text bg-dark border-secondary text-muted"><i class="fas fa-search"></i></span>
                                <input type="text" id="search-input" class="form-control border-start-0" placeholder="–Ü–∑–¥–µ—É..." oninput="filterData()">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <select id="filter-type" class="form-select" onchange="filterData()">
                                <option value="all">–ë–∞—Ä–ª—ã“ì—ã</option>
                                <option value="inc">–¢”©–ª–µ–º–¥–µ—Ä</option>
                                <option value="exp">–®—ã“ì—ã–Ω–¥–∞—Ä</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <select id="sort-order" class="form-select" onchange="filterData()">
                                <option value="date-desc">üìÖ –ñ–∞“£–∞—Å—ã –∞–ª–¥—ã–º–µ–Ω</option>
                                <option value="date-asc">üìÖ –ï—Å–∫—ñ—Å—ñ –∞–ª–¥—ã–º–µ–Ω</option>
                                <option value="amount-desc">üí∞ “ö—ã–º–±–∞—Ç—ã –∞–ª–¥—ã–º–µ–Ω</option>
                                <option value="amount-asc">üí∞ –ê—Ä–∑–∞–Ω—ã –∞–ª–¥—ã–º–µ–Ω</option>
                            </select>
                        </div>
                    </div>
                    <div class="custom-panel p-0" style="background: transparent; border: none; box-shadow: none;">
                        <div id="transaction-list" style="max-height: 600px; overflow-y: auto; padding-right: 5px;"></div>
                    </div>
                </div>
                
                <div id="view-budget" style="display: none;" class="animate-up delay-3">
                    <div class="custom-panel p-4">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h5 class="fw-bold m-0">–ë—é–¥–∂–µ—Ç –∂”ô–Ω–µ –õ–∏–º–∏—Ç—Ç–µ—Ä</h5>
                            <div id="budget-actions">
                                </div>
                        </div>
                        <div id="budget-list">
                            <div class="text-center text-secondary py-5">
                                <i class="fas fa-piggy-bank fa-3x mb-3 text-muted opacity-25"></i>
                                <p>–õ–∏–º–∏—Ç—Ç–µ—Ä ”ô–ª—ñ “õ–æ–π—ã–ª–º–∞“ì–∞–Ω</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="warningModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="background: #1e293b; color: white; border: 1px solid #ef4444; box-shadow: 0 0 30px rgba(239, 68, 68, 0.4);">
                <div class="modal-header border-bottom border-danger">
                    <h5 class="modal-title text-danger fw-bold">
                        <i class="fas fa-exclamation-triangle me-2"></i> –ù–∞–∑–∞—Ä –∞—É–¥–∞—Ä—ã“£—ã–∑!
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center p-4">
                    <p class="fs-5 mb-4">–°—ñ–∑ –æ—Å—ã —Å–∞–Ω–∞—Ç –±–æ–π—ã–Ω—à–∞ –±–µ–ª–≥—ñ–ª–µ–Ω–≥–µ–Ω <b class="text-danger">–õ–ò–ú–ò–¢–¢–ï–ù</b> –∞—Å—ã–ø –∫–µ—Ç–µ—Å—ñ–∑.</p>
                    <div class="bg-dark bg-opacity-50 p-3 rounded-3 border border-secondary border-opacity-25 text-start d-inline-block w-100">
                        <div class="d-flex justify-content-between mb-2">
                            <span class="text-secondary">–ë–µ–ª–≥—ñ–ª–µ–Ω–≥–µ–Ω –õ–∏–º–∏—Ç:</span>
                            <b id="warn-limit" class="text-warning">0</b> ‚Ç∏
                        </div>
                        <div class="d-flex justify-content-between mt-2 pt-2 border-top border-danger border-opacity-25">
                            <span class="text-white">–ë–æ–ª–∞—à–∞“õ –∂–∞–ª–ø—ã —Å–æ–º–∞:</span>
                            <b id="warn-total" class="text-white fs-5">0</b> ‚Ç∏
                        </div>
                    </div>
                    <p class="mt-4 mb-0 text-muted small">–î–µ–≥–µ–Ω–º–µ–Ω “õ–æ—Å–∞ –±–µ—Ä–µ—Å—ñ–∑ –±–µ?</p>
                </div>
                <div class="modal-footer border-top border-secondary justify-content-center p-3">
                    <button type="button" class="btn btn-secondary px-4 rounded-pill" data-bs-dismiss="modal">–ñ–æ“õ, “õ–∞–π—Ç—É</button>
                    <button type="button" class="btn btn-danger px-4 rounded-pill fw-bold shadow-sm" onclick="confirmAddTransaction()">–ò”ô, “õ–æ—Å–∞–º—ã–Ω</button>
                </div>
            </div>
        </div>
    </div>

<div class="modal fade" id="excelModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="background-color: #1e293b; color: white; border: 1px solid #334155; box-shadow: 0 20px 60px rgba(0,0,0,0.6);">
                
                <div class="modal-header border-0 pb-0">
                    <div class="d-flex align-items-center">
                        <div style="width: 50px; height: 50px; background: rgba(16, 185, 129, 0.1); color: #10b981; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; margin-right: 15px; border: 1px solid rgba(16, 185, 129, 0.3);">
                            <i class="fas fa-file-excel"></i>
                        </div>
                        <h5 class="modal-title fw-bold">Excel –≠–∫—Å–ø–æ—Ä—Ç—ã</h5>
                    </div>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-body pt-4">
                    <label class="small text-secondary mb-2" style="font-weight: 600;">–ö–ï–ó–ï“¢</label>
                    <select id="excel-period" class="form-select mb-3" style="background-color: rgba(31, 41, 55, 0.6) !important; border: 1px solid #374151; color: white !important;">
                        <option value="all">–ë–∞—Ä–ª—ã“õ —É–∞“õ—ã—Ç</option>
                        <option value="6months">–°–æ“£“ì—ã 6 –∞–π</option>
                        <option value="3months">–°–æ“£“ì—ã 3 –∞–π</option>
                        <option value="month">–û—Å—ã –∞–π</option>
                        <option value="week">–°–æ“£“ì—ã 7 –∫“Ø–Ω</option>
                        <option value="today">–ë“Ø–≥—ñ–Ω</option>
                    </select>

                    <label class="small text-secondary mb-2" style="font-weight: 600;">–°–ê–ù–ê–¢</label>
                    <select id="excel-type" class="form-select mb-4" style="background-color: rgba(31, 41, 55, 0.6) !important; border: 1px solid #374151; color: white !important;">
                        <option value="all">–ë–∞—Ä–ª—ã“õ —Å–∞–Ω–∞—Ç—Ç–∞—Ä</option>
                        <option value="inc">–¢–µ–∫ –ö—ñ—Ä—ñ—Å—Ç–µ—Ä</option>
                        <option value="exp">–¢–µ–∫ –®—ã“ì—ã–Ω–¥–∞—Ä</option>
                    </select>
                </div>

                <div class="modal-footer border-0">
                    <button type="button" class="btn btn-secondary rounded-pill px-4" data-bs-dismiss="modal">–ë–æ–ª–¥—ã—Ä–º–∞—É</button>
                    <button type="button" class="btn btn-success rounded-pill px-4 fw-bold" onclick="processExcelDownload()">–ñ“Ø–∫—Ç–µ—É</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="profileModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content" style="background: #1e293b; color: white; border: 1px solid #334155; border-radius: 20px;">
            
            <div class="modal-header border-0 pb-0">
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body pt-0 pb-4">
    
    <div class="text-center mb-4 position-relative">
        <div class="d-inline-block position-relative">
            <div style="width: 90px; height: 90px; background: linear-gradient(135deg, #3b82f6, #2563eb); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; color: white; box-shadow: 0 0 20px rgba(59, 130, 246, 0.5); border: 3px solid #1e293b;">
                <i class="fas fa-user"></i>
            </div>
            <button onclick="toggleEditMode()" class="btn btn-sm btn-dark position-absolute bottom-0 end-0 rounded-circle border border-secondary" style="width: 30px; height: 30px; padding: 0; display: flex; align-items: center; justify-content: center;">
                <i class="fas fa-pen fa-xs text-white"></i>
            </button>
        </div>

        <div id="view-mode" class="mt-3">
            <h4 class="fw-bold text-white mb-0" id="profile-name">User Name</h4>
            <div class="badge bg-primary bg-opacity-25 text-primary px-3 py-1 rounded-pill mt-1 mb-1" style="font-size: 0.7rem;">Pro Account</div>
            <p class="text-secondary small mb-0" id="profile-email">email@example.com</p>
        </div>

        <div id="edit-mode" class="mt-3" style="display: none;">
            <div class="mb-2">
                <label class="small text-secondary text-start w-100 ps-1">–ê—Ç—ã“£—ã–∑</label>
                <input type="text" id="edit-username" class="form-control form-control-sm bg-dark text-white border-secondary text-center">
            </div>
            <div class="mb-3">
                <label class="small text-secondary text-start w-100 ps-1">Email (–õ–æ–≥–∏–Ω)</label>
                <input type="email" id="edit-email" class="form-control form-control-sm bg-dark text-white border-secondary text-center">
            </div>
            <div class="d-flex gap-2 justify-content-center">
                <button onclick="saveProfileChanges()" class="btn btn-sm btn-success px-4 rounded-pill">–°–∞“õ—Ç–∞—É</button>
                <button onclick="toggleEditMode()" class="btn btn-sm btn-secondary px-4 rounded-pill">“ö–∞–π—Ç—É</button>
            </div>
        </div>
    </div>

    <h6 class="text-secondary small fw-bold text-uppercase ms-1 mb-2 text-start">“ö–∞—É—ñ–ø—Å—ñ–∑–¥—ñ–∫</h6>
    
    <button onclick="togglePasswordForm()" id="btn-change-pass" class="btn btn-outline-light w-100 py-3 rounded-3 mb-2 text-start px-3 border-0" style="background: rgba(255,255,255,0.05);">
        <i class="fas fa-key text-info me-3 ms-1"></i> “ö“±–ø–∏—è —Å”©–∑–¥—ñ ”©–∑–≥–µ—Ä—Ç—É
        <i class="fas fa-chevron-down float-end mt-1 small"></i>
    </button>

    <div id="password-form" class="p-3 rounded-3 mb-3" style="background: rgba(0,0,0,0.2); display: none; border: 1px solid rgba(255,255,255,0.1);">
        <input type="password" id="old-pass" class="form-control form-control-sm mb-2 bg-dark text-white border-secondary" placeholder="–ï—Å–∫—ñ “õ“±–ø–∏—è —Å”©–∑">
        <input type="password" id="new-pass" class="form-control form-control-sm mb-2 bg-dark text-white border-secondary" placeholder="–ñ–∞“£–∞ “õ“±–ø–∏—è —Å”©–∑">
        <input type="password" id="confirm-pass" class="form-control form-control-sm mb-3 bg-dark text-white border-secondary" placeholder="“ö“±–ø–∏—è —Å”©–∑–¥—ñ “õ–∞–π—Ç–∞–ª–∞“£—ã–∑">
        

        <div class="d-flex gap-2">
            <button onclick="saveNewPassword()" class="btn btn-sm btn-success flex-grow-1">–°–∞“õ—Ç–∞—É</button>
            <button onclick="togglePasswordForm()" class="btn btn-sm btn-secondary">–ë–æ–ª–¥—ã—Ä–º–∞—É</button>
        </div>
    </div>
    <h6 class="text-secondary small fw-bold text-uppercase ms-1 mb-2 text-start mt-3">–ê–∫–∫–∞—É–Ω—Ç</h6>
    
    <button onclick="deleteAccount()" class="btn btn-outline-danger w-100 py-2 rounded-3 mb-3 border-0 text-start px-3" style="background: rgba(239, 68, 68, 0.1);">
        <i class="fas fa-trash-alt me-3 ms-1"></i> –ê–∫–∫–∞—É–Ω—Ç—Ç—ã ”©—à—ñ—Ä—É
    </button>

    <button onclick="logout()" class="btn btn-danger w-100 py-3 rounded-4 fw-bold shadow-sm">
        <i class="fas fa-sign-out-alt me-2"></i> –®—ã“ì—É
    </button>
</div>
<div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 1100;">
    <div id="liveToast" class="toast align-items-center text-white bg-success border-0" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="d-flex">
            <div class="toast-body" id="toast-message">
                –°”ô—Ç—Ç—ñ –æ—Ä—ã–Ω–¥–∞–ª–¥—ã!
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
    </div>
</div>
        </div>
    </div>
</div>
    <div class="modal fade" id="budgetModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="background: #1e293b; color: white; border: 1px solid #334155; box-shadow: 0 10px 50px rgba(0,0,0,0.5);">
                <div class="modal-header border-bottom border-secondary">
                    <h5 class="modal-title fw-bold"><i class="fas fa-plus-circle me-2 text-warning"></i> –ñ–∞“£–∞ –õ–∏–º–∏—Ç “õ–æ—Å—É</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                
                <div class="modal-body p-4">
                    <label class="small text-secondary mb-1">–°–∞–Ω–∞—Ç—Ç—ã —Ç–∞“£–¥–∞“£—ã–∑</label>
                    <select id="budget-cat-id" class="form-select mb-3">
                        <optgroup label="üî¥ –®—ã“ì—ã–Ω–¥–∞—Ä">
                            <option value="1">üçî –¢–∞–º–∞“õ</option>
                            <option value="2">üöå –ö”©–ª—ñ–∫</option>
                            <option value="3">üõçÔ∏è –°–∞—Ç—ã–ø –∞–ª—É</option>
                            <option value="4">üéÆ –û–π—ã–Ω-—Å–∞—É—ã“õ</option>
                            <option value="5">üí° –ö–æ–º–º—É–Ω–∞–ª–¥—ã“õ</option>
                            <option value="6">üíä –î–µ–Ω—Å–∞—É–ª—ã“õ</option>
                            <option value="7">üéì –ë—ñ–ª—ñ–º</option>
                            <option value="9">üì¶ –ë–∞—Å“õ–∞ (–®—ã“ì—ã–Ω)</option>
                        </optgroup>
                        
                        <optgroup label="üü¢ –¢”©–ª–µ–º–¥–µ—Ä (–ñ–æ—Å–ø–∞—Ä–ª–∞—É)">
                            <option value="10">üí∞ –ñ–∞–ª–∞“õ—ã</option>
                            <option value="11">üíª –§—Ä–∏–ª–∞–Ω—Å</option>
                            <option value="12">üìà –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏—è</option>
                            <option value="13">üéÅ –°—ã–π–ª—ã“õ</option>
                            <option value="14">üîÑ “ö–∞–π—Ç–∞—Ä—ã–º </option>
                            <option value="15">üì¶ –ë–∞—Å“õ–∞ </option>
                        </optgroup>
                    </select>
                    
                    <label class="small text-secondary mb-1">–õ–∏–º–∏—Ç —Å–æ–º–∞—Å—ã (‚Ç∏)</label>
                    <div class="input-group mb-3">
                        <span class="input-group-text bg-dark border-secondary text-muted">‚Ç∏</span>
                        <input type="number" id="budget-amount" class="form-control border-start-0" placeholder="50000">
                    </div>

                    <label class="small text-secondary mb-1">–ê—è“õ—Ç–∞–ª—É –∫“Ø–Ω—ñ</label>
                    <input type="date" id="budget-end-date" class="form-control">
                </div>
                <div class="modal-footer border-top border-secondary">
                    <button type="button" class="btn btn-secondary rounded-pill" data-bs-dismiss="modal">–ñ–∞–±—É</button>
                    <button type="button" class="btn btn-primary rounded-pill fw-bold shadow-sm" onclick="saveBudget()">–°–∞“õ—Ç–∞—É</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // ------------------------------------------------------------------
        // 1. –ì–õ–û–ë–ê–õ–¨–î–´ –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø–õ–ê–†
        // ------------------------------------------------------------------
        const API_URL = "https://expense-tracker-api-iy65.onrender.com";
        let token = localStorage.getItem("access_token");
        let currentType = 'expense'; 
        let isLoginMode = true; 
        

        let allTransactions = [];
        let allBudgets = [];
        

        const catNames = { 

            1: "–¢–∞–º–∞“õ", 2: "–ö”©–ª—ñ–∫", 3: "–°–∞—Ç—ã–ø –∞–ª—É", 4: "–û–π—ã–Ω-—Å–∞—É—ã“õ", 
            5: "–¢”©–ª–µ–º–¥–µ—Ä", 6: "–î–µ–Ω—Å–∞—É–ª—ã“õ", 7: "–ë—ñ–ª—ñ–º", 8: "–°–∞—è—Ö–∞—Ç", 9: "–ë–∞—Å“õ–∞",

            10: "–ñ–∞–ª–∞“õ—ã", 11: "–§—Ä–∏–ª–∞–Ω—Å", 12: "–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏—è", 
            13: "–°—ã–π–ª—ã“õ", 14: "“ö–∞–π—Ç–∞—Ä—ã–º", 15: "–ë–∞—Å“õ–∞"
        };


        document.getElementById('date').valueAsDate = new Date();
        

        if (token) showApp();

        // ------------------------------------------------------------------
        // 2. –ò–ù–¢–ï–†–§–ï–ô–° –ë–ê–°“ö–ê–†–£ (UI LOGIC)
        // ------------------------------------------------------------------
        

        function switchTab(tab) {
            ['dashboard', 'transactions', 'budget'].forEach(t => {
                document.getElementById('view-' + t).style.display = 'none';
            });
            ['tab-dashboard', 'tab-transactions', 'tab-budget'].forEach(t => {
                document.getElementById(t).classList.remove('active');
            });

            document.getElementById('view-' + tab).style.display = 'block';
            document.getElementById('tab-' + tab).classList.add('active');
            

            if(tab === 'transactions') renderListOnly(allTransactions);
        }


        function setType(type) {
            currentType = type;
            const btnExp = document.getElementById('btn-expense');
            const btnInc = document.getElementById('btn-income');
            
            const expenseWrapper = document.getElementById('expense-cat-wrapper');
            const incomeWrapper = document.getElementById('income-cat-wrapper');

            if (type === 'expense') {
                btnExp.className = 'toggle-btn active-expense';
                btnInc.className = 'toggle-btn';

                expenseWrapper.style.display = 'block';
                incomeWrapper.style.display = 'none';
            } else {
                btnInc.className = 'toggle-btn active-income';
                btnExp.className = 'toggle-btn';

                expenseWrapper.style.display = 'none';
                incomeWrapper.style.display = 'block';
            }
        }

        // ------------------------------------------------------------------
        // 3. –ê–£–¢–ï–ù–¢–ò–§–ò–ö–ê–¶–ò–Ø (AUTH)
        // ------------------------------------------------------------------
        // --- –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø –õ–û–ì–ò–ö–ê–°–´ ---
        
        // --- –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø –õ–û–ì–ò–ö–ê–°–´ ---

        function toggleAuthMode() {
            isLoginMode = !isLoginMode;
            
            // 1. –ú”ô—Ç—ñ–Ω–¥–µ—Ä–¥—ñ –∞—É—ã—Å—Ç—ã—Ä—É
            document.getElementById("auth-title").innerText = isLoginMode ? "–ñ“Ø–π–µ–≥–µ –∫—ñ—Ä—É" : "–¢—ñ—Ä–∫–µ–ª—É";
            document.getElementById("auth-btn").innerText = isLoginMode ? "–ö—ñ—Ä—É" : "–¢—ñ—Ä–∫–µ–ª—É";
            document.getElementById("auth-switch-text").innerText = isLoginMode ? "–ê–∫–∫–∞—É–Ω—Ç—ã“£—ã–∑ –∂–æ“õ –ø–∞? –¢—ñ—Ä–∫–µ–ª—É" : "–ê–∫–∫–∞—É–Ω—Ç—ã“£—ã–∑ –±–∞—Ä –º–∞? –ö—ñ—Ä—É";
            
            // 2. ”®—Ä—ñ—Å—Ç–µ—Ä–¥—ñ –∫”©—Ä—Å–µ—Ç—É/–∂–∞—Å—ã—Ä—É
            const displayStyle = isLoginMode ? "none" : "block";
            document.getElementById("register-fields").style.display = displayStyle;     // –ê—Ç—ã
            document.getElementById("confirm-pass-group").style.display = displayStyle;  // –ü–∞—Ä–æ–ª—å–¥—ñ —Ä–∞—Å—Ç–∞—É
            
            // 3. –ü–ê–†–û–õ–¨ PLACEHOLDER ”®–ó–ì–ï–†–¢–£ (–û–°–´ –ñ–ï–†–î–Ü “ö–û–°–¢–´–ú)
            const passInput = document.getElementById("auth-password");
            if (isLoginMode) {
                passInput.placeholder = "‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"; // –ö—ñ—Ä—É –∫–µ–∑—ñ–Ω–¥–µ
            } else {
                passInput.placeholder = "–ö–µ–º—ñ–Ω–¥–µ 6 —Ç–∞“£–±–∞"; // –¢—ñ—Ä–∫–µ–ª—É –∫–µ–∑—ñ–Ω–¥–µ
            }

            // “ö–∞—Ç–µ —Ö–∞–±–∞—Ä–ª–∞–º–∞—Å—ã–Ω –∂–∞—Å—ã—Ä—É
            document.getElementById("error-msg").style.display = "none";
        }

        async function handleAuth() {
            const email = document.getElementById("auth-email").value;
            const password = document.getElementById("auth-password").value;
            const btn = document.getElementById("auth-btn");
            const errorDiv = document.getElementById("error-msg");
            
            // –í–ê–õ–ò–î–ê–¶–ò–Ø: –¢—ñ—Ä–∫–µ–ª—É –∫–µ–∑—ñ–Ω–¥–µ –ø–∞—Ä–æ–ª—å–¥–µ—Ä–¥—ñ —Ç–µ–∫—Å–µ—Ä—É
            if (!isLoginMode) {
                const confirmPass = document.getElementById("reg-confirm-password").value;
                
                if (password !== confirmPass) {
                    errorDiv.innerText = "“ö“±–ø–∏—è —Å”©–∑–¥–µ—Ä —Å”ô–π–∫–µ—Å –∫–µ–ª–º–µ–π–¥—ñ!";
                    errorDiv.style.display = "block";
                    return; 
                }
                if (password.length < 4) { // “ö–∞—É—ñ–ø—Å—ñ–∑–¥—ñ–∫ “Ø—à—ñ–Ω 4 –Ω–µ–º–µ—Å–µ 6 –¥–µ–ø “õ–æ—é“ì–∞ –±–æ–ª–∞–¥—ã
                    errorDiv.innerText = "“ö“±–ø–∏—è —Å”©–∑ —Ç—ã–º “õ—ã—Å“õ–∞!";
                    errorDiv.style.display = "block";
                    return;
                }
            }

            btn.innerText = "–ö“Ø—Ç–µ —Ç“±—Ä—ã“£—ã–∑...";

            try {
                if (isLoginMode) {
                    // --- –õ–û–ì–ò–ù ---
                    const res = await fetch(`${API_URL}/token`, { 
                        method: "POST", 
                        body: new URLSearchParams({username: email, password: password}) 
                    });
                    
                    if(!res.ok) throw new Error();
                    const data = await res.json();
                    
                    localStorage.setItem("access_token", data.access_token);
                    token = data.access_token;
                    showApp();
                } else {
                    // --- –¢–Ü–†–ö–ï–õ–£ ---
                    const u = document.getElementById("reg-username").value;
                    const res = await fetch(`${API_URL}/users/`, { 
                        method: "POST", 
                        headers: {"Content-Type":"application/json"}, 
                        body:JSON.stringify({username:u, email:email, password:password}) 
                    });
                    
                    if (res.ok) { 
                        alert("–°”ô—Ç—Ç—ñ —Ç—ñ—Ä–∫–µ–ª–¥—ñ“£—ñ–∑! –ï–Ω–¥—ñ –∫—ñ—Ä—ñ“£—ñ–∑."); 
                        toggleAuthMode(); 
                        // ”®—Ä—ñ—Å—Ç–µ—Ä–¥—ñ —Ç–∞–∑–∞–ª–∞—É
                        document.getElementById("auth-password").value = ""; 
                        document.getElementById("reg-confirm-password").value = ""; 
                    } else { 
                        throw new Error(); 
                    }
                }
            } catch { 
                errorDiv.innerText = "“ö–∞—Ç–µ –¥–µ—Ä–µ–∫—Ç–µ—Ä –Ω–µ–º–µ—Å–µ —Å–µ—Ä–≤–µ—Ä –∂–∞—É–∞–ø –±–µ—Ä–º–µ–¥—ñ!"; 
                errorDiv.style.display = "block"; 
            } finally {
                btn.innerText = isLoginMode ? "–ö—ñ—Ä—É" : "–¢—ñ—Ä–∫–µ–ª—É";
            }
        }

        function logout() {
            localStorage.removeItem("access_token");
            location.reload();
        }

        function showApp() {
            document.getElementById('auth-screen').style.display='none';
            document.getElementById('app-screen').style.display='block';
            loadData();
            loadBudgets();
            
            fetch(`${API_URL}/users/me/`, { headers: {"Authorization": `Bearer ${token}`} })
                .then(r => r.json())
                .then(u => {
                    document.getElementById("user-name").innerText = u.username;
                    document.getElementById("user-email").innerText = u.email;
                });
        }

        // ------------------------------------------------------------------
        // 4. –î–ï–†–ï–ö–¢–ï–†–î–Ü –ñ“Æ–ö–¢–ï–£ (DATA LOADING)
        // ------------------------------------------------------------------
        async function loadData() {
            const headers = { "Authorization": `Bearer ${token}` };
            try {
                const [r1, r2] = await Promise.all([
                    fetch(`${API_URL}/expenses/`, { headers }),
                    fetch(`${API_URL}/incomes/`, { headers })
                ]);
                
                const exp = await r1.json();
                const inc = await r2.json();
                
                allTransactions = [
                    ...exp.map(x=>({...x, type:'exp'})), 
                    ...inc.map(x=>({...x, type:'inc'}))
                ];
                
                allTransactions.sort((a,b) => new Date(b.date) - new Date(a.date));
                
                applyFilter('all');

            } catch(e) { console.error("Data loading failed:", e); }
        }

        // ------------------------------------------------------------------
        // 5. –°“Æ–ó–ì–Ü–õ–ï–£ –ñ”ò–ù–ï –í–ò–ó–£–ê–õ–ò–ó–ê–¶–ò–Ø (FILTERING & CHARTS)
        // ------------------------------------------------------------------
// --- –î“∞–†–´–°–¢–ê–õ“í–ê–ù –§–ò–õ–¨–¢–† (Timezone –∂–æ“õ + –ö–∞—Ä—Ç–æ—á–∫–∞–ª–∞—Ä —ñ—Å—Ç–µ–π–¥—ñ) ---
        function applyFilter(period) {
            document.querySelectorAll('.filter-btn, .filter-chip').forEach(b => b.classList.remove('active'));
            const btn = document.getElementById('filter-' + period) || document.getElementById('btn-filter-' + period);
            if (btn) btn.classList.add('active');

            const today = new Date(); today.setHours(0, 0, 0, 0);

            let filtered = allTransactions.filter(item => {
                const dParts = item.date.split('T')[0].split('-');
                const txDate = new Date(dParts[0], dParts[1] - 1, dParts[2]); txDate.setHours(0, 0, 0, 0);

                if (period === 'all') return true;
                if (period === 'today') return txDate.getTime() === today.getTime();
                if (period === 'week') { const w = new Date(today); w.setDate(today.getDate() - 7); return txDate >= w; }
                if (period === 'month') { const m = new Date(today.getFullYear(), today.getMonth(), 1); return txDate >= m; }
                if (period === '3months') { const m3 = new Date(today); m3.setMonth(today.getMonth() - 3); return txDate >= m3; }
                if (period === '6months') { const m6 = new Date(today); m6.setMonth(today.getMonth() - 6); return txDate >= m6; }
                return true;
            });

            renderListOnly(filtered);

            let inc = 0, exp = 0;
            const catMap = {};

            filtered.forEach(i => { 
                if (i.type === 'inc') inc += i.amount; 
                else {
                    exp += i.amount;
                    const cName = catNames[i.category_id] || '–ë–∞—Å“õ–∞';
                    catMap[cName] = (catMap[cName] || 0) + i.amount;
                }
            });

            document.getElementById("total-income").innerText = inc.toLocaleString() + " ‚Ç∏";
            document.getElementById("total-expenses").innerText = exp.toLocaleString() + " ‚Ç∏";
            document.getElementById("net-balance").innerText = (inc - exp).toLocaleString() + " ‚Ç∏";

            // –ì–†–ê–§–ò–ö–¢–ï–†–î–Ü –®–ê“ö–´–†–£
            const dData = Object.keys(catMap).map(k => ({category_name: k, total_amount: catMap[k]}));
            
            setTimeout(() => {
                if (typeof drawSummaryChart === "function") drawSummaryChart(inc, exp);
                if (typeof drawDoughnut === "function") drawDoughnut(dData);
            }, 100);
        }

        function updateUI(data, isWeekly, labels) {
            renderListOnly(data); 

            let totalInc = 0, totalExp = 0;
            let dailyData = { inc: new Array(7).fill(0), exp: new Array(7).fill(0) };
            const catData = {};

            data.forEach(i => {
                if (i.type === 'inc') totalInc += i.amount; 
                else totalExp += i.amount;
                
                if (i.type === 'exp') { 
                    const c = catNames[i.category_id] || "–ë–∞—Å“õ–∞"; 
                    catData[c] = (catData[c] || 0) + i.amount; 
                }
                
                if (isWeekly) {
                    const txDate = new Date(i.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                    const idx = labels.indexOf(txDate);
                    if(idx !== -1) { 
                        if(i.type==='inc') dailyData.inc[idx] += i.amount; 
                        else dailyData.exp[idx] += i.amount; 
                    }
                }
            });

            document.getElementById("total-income").innerText = totalInc.toLocaleString() + " ‚Ç∏";
            document.getElementById("total-expenses").innerText = totalExp.toLocaleString() + " ‚Ç∏";
            document.getElementById("net-balance").innerText = (totalInc - totalExp).toLocaleString() + " ‚Ç∏";

            if (isWeekly) drawWeeklyChart(labels, dailyData.inc, dailyData.exp); 
            else drawSummaryChart(totalInc, totalExp);
            
            drawDoughnut(catData);
        }


        function filterData() {
            const text = document.getElementById("search-input").value.toLowerCase();
            const type = document.getElementById("filter-type").value;
            const sortOrder = document.getElementById("sort-order")?.value || "date-desc";

            let filtered = allTransactions.filter(item => {
                const cat = (catNames[item.category_id] || item.description || "").toLowerCase();
                const matchText = cat.includes(text);
                
                let matchType = true;
                if (type === 'inc') matchType = (item.type === 'inc');
                if (type === 'exp') matchType = (item.type === 'exp');
                
                return matchText && matchType;
            });


            filtered.sort((a, b) => {
                if (sortOrder === 'date-desc') return new Date(b.date) - new Date(a.date);
                if (sortOrder === 'date-asc') return new Date(a.date) - new Date(b.date);
                if (sortOrder === 'amount-desc') return b.amount - a.amount;
                if (sortOrder === 'amount-asc') return a.amount - b.amount;
                return 0;
            });
            
            renderListOnly(filtered);
        }

        function renderListOnly(data) {
            const list = document.getElementById("transaction-list");
            list.innerHTML = "";
            if (data.length === 0) { 
                list.innerHTML = '<div class="text-center text-secondary py-5">–î–µ—Ä–µ–∫—Ç–µ—Ä —Ç–∞–±—ã–ª–º–∞–¥—ã</div>'; 
                return; 
            }

            data.forEach(i => {
                const isExp = i.type === 'exp';
                const catName = isExp ? (catNames[i.category_id] || "–ë–∞—Å“õ–∞") : (catNames[i.category_id] || "–¢”©–ª–µ–º");
                
                list.innerHTML += `
                    <div class="tx-item animate-up">
                        <div class="d-flex align-items-center">
                            <div class="tx-icon ${isExp?'icon-exp':'icon-inc'}">
                                <i class="fas ${isExp?'fa-arrow-down':'fa-arrow-up'}"></i>
                            </div>
                            <div>
                                <div class="tx-cat">${catName}</div>
                                <div class="tx-date">${i.date.split('T')[0]}</div>
                            </div>
                        </div>
                        <div class="d-flex align-items-center">
                            <span class="tx-amt ${isExp?'text-red':'text-green'}">
                                ${isExp?'-':'+'} ${i.amount.toLocaleString()} ‚Ç∏
                            </span>
                            <button class="btn-del ms-2" onclick="deleteItem(${i.id}, '${i.type}')">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </div>
                    </div>`;
            });
        }

        // ------------------------------------------------------------------
        // 6. –¢–†–ê–ù–ó–ê–ö–¶–ò–Ø “ö–û–°–£ –ñ”ò–ù–ï –õ–ò–ú–ò–¢–¢–ï–† (ADD & BUDGET CHECK)
        // ------------------------------------------------------------------
        let pendingBody = null;

        function checkBudgetLimit(catId, amountToAdd) {
            const budget = allBudgets.find(b => b.category_id === catId);
            if (!budget) return null;
            
            const currentSpent = allTransactions
                .filter(t => t.type === 'exp' && t.category_id === catId)
                .reduce((sum, t) => sum + t.amount, 0);
            
            const totalAfter = currentSpent + amountToAdd;
            
            if (totalAfter > budget.limit_amount) {
                return { limit: budget.limit_amount, total: totalAfter };
            }
            return null;
        }

        async function addTransaction() {
            const amount = parseFloat(document.getElementById("amount").value);
            const desc = document.getElementById("desc").value;
            const dateVal = document.getElementById("date").value;
            
            if (!amount) { alert("–°–æ–º–∞–Ω—ã –∂–∞–∑—ã“£—ã–∑!"); return; }
            
            const body = { amount: amount, description: desc, date: dateVal };

            if (currentType === 'expense') {
                const catId = parseInt(document.getElementById("expense-cat-id").value);
                body.category_id = catId;    
                
                const warning = checkBudgetLimit(catId, amount);
                if (warning) {
                    pendingBody = body; 
                    document.getElementById("warn-limit").innerText = warning.limit.toLocaleString();
                    document.getElementById("warn-total").innerText = warning.total.toLocaleString();
                    new bootstrap.Modal(document.getElementById('warningModal')).show(); 
                    return;
                }
            } 

            else { 
                const catId = parseInt(document.getElementById("income-cat-id").value);
                body.category_id = catId; 
            }

            await sendTransaction(body);
        }

        async function confirmAddTransaction() {
            if (pendingBody) {
                await sendTransaction(pendingBody);
                bootstrap.Modal.getInstance(document.getElementById('warningModal')).hide();
                pendingBody = null;
            }
        }

        async function sendTransaction(body) {
            try {
                const res = await fetch(`${API_URL}/${currentType}s/`, {
                    method: "POST", headers: { "Authorization": `Bearer ${token}`, "Content-Type": "application/json" },
                    body: JSON.stringify(body)
                });
                if(res.ok) {
                    alert("–°”ô—Ç—Ç—ñ “õ–æ—Å—ã–ª–¥—ã!");
                    document.getElementById("amount").value = "";
                    document.getElementById("desc").value = "";
                    loadData(); loadBudgets();
                } else { alert("“ö–∞—Ç–µ! –î–µ—Ä–µ–∫—Ç–µ—Ä–¥—ñ —Ç–µ–∫—Å–µ—Ä—ñ“£—ñ–∑."); }
            } catch { alert("–°–µ—Ä–≤–µ—Ä “õ–∞—Ç–µ—Å—ñ!"); }
        }

        async function deleteItem(id, type) {
            if(!confirm("”®—à—ñ—Ä—É–≥–µ —Å–µ–Ω—ñ–º–¥—ñ—Å—ñ–∑ –±–µ?")) return;
            const endpoint = type === 'exp' ? `/expenses/${id}` : null;
            if(!endpoint) { alert("–¢”©–ª–µ–º–¥—ñ ”©—à—ñ—Ä—É –º“Ø–º–∫—ñ–Ω –µ–º–µ—Å"); return; }
            await fetch(`${API_URL}${endpoint}`, { method: "DELETE", headers: { "Authorization": `Bearer ${token}` } });
            loadData(); loadBudgets();
        }

        // ------------------------------------------------------------------
        // 7. –ì–†–ê–§–ò–ö–¢–ï–† (CHARTS)
        // ------------------------------------------------------------------
        let myChart;
        

        function drawSummaryChart(inc, exp) { 
            const ctx = document.getElementById('barChart'); 
            if(myChart) myChart.destroy(); 
            
            myChart = new Chart(ctx, { 
                type: 'bar', 
                data: { 
                    labels: ['–¢”©–ª–µ–º', '–®—ã“ì—ã—Å'], 
                    datasets: [{ 
                        label: '–°–æ–º–∞', 
                        data: [inc, exp], 
                        backgroundColor: ['#10b981', '#ef4444'], 
                        borderRadius: 10, 
                        barThickness: 80 
                    }] 
                }, 
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false, 
                    scales: { 
                        y: { beginAtZero: true, grid: {color: '#374151'} }, 
                        x: { grid: {display: false} } 
                    }, 
                    plugins: { legend: { display: false } } 
                } 
            }); 
        }

        function drawWeeklyChart(labels, incData, expData) { 
            const ctx = document.getElementById('barChart'); 
            if(myChart) myChart.destroy(); 
            
            myChart = new Chart(ctx, { 
                type: 'bar', 
                data: { 
                    labels: labels, 
                    datasets: [ 
                        { 
                            label: '–¢”©–ª–µ–º', 
                            data: incData, 
                            backgroundColor: '#10b981', 
                            borderRadius: 5, 
                            barPercentage: 0.6, 
                            categoryPercentage: 0.8 
                        }, 
                        { 
                            label: '–®—ã“ì—ã—Å', 
                            data: expData, 
                            backgroundColor: '#ef4444', 
                            borderRadius: 5, 
                            barPercentage: 0.6, 
                            categoryPercentage: 0.8 
                        } 
                    ] 
                }, 
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false, 
                    scales: { 
                        y: { beginAtZero: true, grid: {color: '#374151'} }, 
                        x: { grid: {display: false} } 
                    }, 
                    plugins: { legend: { labels: { color: 'white' } } } 
                } 
            }); 
        }

        function drawDoughnut(catData) { 
            const ctx = document.getElementById('doughnutChart'); 
            if (doughnutInstance) doughnutInstance.destroy(); 
            
            doughnutInstance = new Chart(ctx, { 
                type: 'doughnut', 
                data: { 
                    labels: Object.keys(catData), 
                    datasets: [{ 
                        data: Object.values(catData), 
                        backgroundColor: ['#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6', '#ec4899'], 
                        borderWidth: 0 
                    }] 
                }, 
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false, 
                    plugins: { legend: { position: 'right', labels: { color: 'white' } } } 
                } 
            }); 
        }
        
        // ------------------------------------------------------------------
        // 8. EXCEL EXPORT
        // ------------------------------------------------------------------
function openExcelModal() {
            new bootstrap.Modal(document.getElementById('excelModal')).show();
        }

        async function processExcelDownload() {
            const period = document.getElementById('excel-period').value;
            const type = document.getElementById('excel-type').value;
            
            let filtered = [...allTransactions];
            const now = new Date();


            if (period === 'today') {
                const start = new Date(); start.setHours(0,0,0,0);
                filtered = filtered.filter(i => new Date(i.date) >= start);
            } else if (period === 'week') {
                const start = new Date(); start.setDate(now.getDate() - 7); start.setHours(0,0,0,0);
                filtered = filtered.filter(i => new Date(i.date) >= start);
            } else if (period === 'month') {
                const start = new Date(now.getFullYear(), now.getMonth(), 1);
                filtered = filtered.filter(i => new Date(i.date) >= start);
            } else if (period === '3months') {
                const start = new Date(); start.setMonth(now.getMonth() - 3); start.setHours(0,0,0,0);
                filtered = filtered.filter(i => new Date(i.date) >= start);
            } else if (period === '6months') {
                const start = new Date(); start.setMonth(now.getMonth() - 6); start.setHours(0,0,0,0);
                filtered = filtered.filter(i => new Date(i.date) >= start);
            }


            if (type === 'inc') filtered = filtered.filter(i => i.type === 'inc');
            if (type === 'exp') filtered = filtered.filter(i => i.type === 'exp');

            if (filtered.length === 0) {
                alert("–¢–∞“£–¥–∞–ª“ì–∞–Ω –∫–µ–∑–µ“£–¥–µ –¥–µ—Ä–µ–∫—Ç–µ—Ä –∂–æ“õ!");
                return;
            }


            const wb = new ExcelJS.Workbook();
            const ws = wb.addWorksheet('Transactions');
            

            ws.columns = [
                { header: '–ö“Ø–Ω—ñ', key: 'd', width: 15 },
                { header: '–¢“Ø—Ä—ñ', key: 't', width: 15 },
                { header: '–°–∞–Ω–∞—Ç', key: 'c', width: 20 },
                { header: '–°–∏–ø–∞—Ç—Ç–∞–º–∞', key: 'desc', width: 30 },
                { header: '–°–æ–º–∞', key: 'a', width: 20 }
            ];


            ws.getRow(1).font = { bold: true, color: { argb: 'FFFFFFFF' } };
            ws.getRow(1).fill = { type: 'pattern', pattern: 'solid', fgColor: { argb: 'FF10B981' } };

           filtered.forEach(i => {
                const isExp = i.type === 'exp';
                const row = ws.addRow({
                    d: i.date.split('T')[0],
                    t: isExp ? '–®—ã“ì—ã–Ω' : '–ö—ñ—Ä—ñ—Å',
                    c: catNames[i.category_id] || (isExp ? '–ë–∞—Å“õ–∞' : '–¢”©–ª–µ–º'),
                    desc: i.description || '',
                    a: i.amount
                });

                const color = isExp ? 'FFEF4444' : 'FF10B981';
                row.getCell('a').font = { color: { argb: color }, bold: true };
            });
            const buf = await wb.xlsx.writeBuffer();
            saveAs(new Blob([buf]), `Qarjy_Pro_${period}.xlsx`);
            
            bootstrap.Modal.getInstance(document.getElementById('excelModal')).hide();
        }
        // ------------------------------------------------------------------
        // 9. –ë–Æ–î–ñ–ï–¢–¢–Ü –ë–ê–°“ö–ê–†–£
        // ------------------------------------------------------------------
        function openBudgetModal() { 
            new bootstrap.Modal(document.getElementById('budgetModal')).show(); 
        }
        
        async function saveBudget() {
            const limit = document.getElementById('budget-amount').value; 
            const catId = document.getElementById('budget-cat-id').value; 
            const endDate = document.getElementById('budget-end-date').value;
            
            if(!limit || !endDate) return alert("–ë–∞—Ä–ª—ã“õ ”©—Ä—ñ—Å—Ç—ñ —Ç–æ–ª—Ç—ã—Ä!");
            
            const body = { 
                limit_amount: parseFloat(limit), 
                category_id: parseInt(catId), 
                start_date: new Date().toISOString().split('T')[0], 
                end_date: endDate 
            };
            
            try { 
                const res = await fetch(`${API_URL}/budgets/`, { 
                    method: "POST", 
                    headers: { "Authorization": `Bearer ${token}`, "Content-Type": "application/json" }, 
                    body: JSON.stringify(body) 
                });
                if(res.ok) { 
                    alert("–õ–∏–º–∏—Ç “õ–æ–π—ã–ª–¥—ã!"); 
                    bootstrap.Modal.getInstance(document.getElementById('budgetModal')).hide(); 
                    loadBudgets(); 
                } else { alert("“ö–∞—Ç–µ —à—ã“õ—Ç—ã!"); } 
            } catch { alert("–°–µ—Ä–≤–µ—Ä “õ–∞—Ç–µ—Å—ñ!"); }
        }

        async function loadBudgets() {
            try {

                const [resBudgets, resStats] = await Promise.all([
                    fetch(`${API_URL}/budgets/`, { headers: { "Authorization": `Bearer ${token}` } }),
                    fetch(`${API_URL}/statistics/expenses/`, { headers: { "Authorization": `Bearer ${token}` } })
                ]);
                
                const budgets = await resBudgets.json();
                const stats = await resStats.json();
                
                const expenseMap = {};
                stats.forEach(s => expenseMap[s.category_name] = s.total_amount);

                const list = document.getElementById("budget-list");
                list.innerHTML = "";

                if(budgets.length === 0) {
                    list.innerHTML = '<div class="text-center text-secondary py-5"><i class="fas fa-wallet fa-3x mb-3 opacity-25"></i><p>–õ–∏–º–∏—Ç—Ç–µ—Ä ”ô–ª—ñ “õ–æ–π—ã–ª–º–∞“ì–∞–Ω</p></div>';
                    return;
                }


                const icons = {
                    1: "fa-utensils", 2: "fa-car", 3: "fa-shopping-bag", 4: "fa-gamepad",
                    5: "fa-home", 6: "fa-medkit", 7: "fa-graduation-cap", 8: "fa-plane", 9: "fa-box"
                };

                budgets.forEach(b => {
                    const catName = catNames[b.category_id] || "–ë–µ–ª–≥—ñ—Å—ñ–∑";
                    const spent = expenseMap[catName] || 0;
                    const limit = b.limit_amount;
                    const remaining = limit - spent;
                    
                    let percent = (spent / limit) * 100;
                    if (percent > 100) percent = 100;


                    let progressColor = "#10b981";
                    let remainingColor = "text-success";
                    let statusIcon = "fa-check-circle"; 
                    let statusColor = "text-success";

                    if (percent > 70) { progressColor = "#f59e0b"; remainingColor = "text-warning"; } // –°–∞—Ä—ã
                    if (percent >= 100) { 
                        progressColor = "#ef4444"; 
                        remainingColor = "text-danger"; 
                        statusIcon = "fa-exclamation-circle"; 
                        statusColor = "text-danger";
                    }

                    list.innerHTML += `
                        <div class="p-3 mb-3 rounded-4 border" style="background: #1e293b; border-color: #334155 !important;">
                            
                            <div class="d-flex justify-content-between align-items-start mb-3">
                                <div class="d-flex gap-3 align-items-center">
                                    <div class="rounded-3 d-flex align-items-center justify-content-center text-white" 
                                         style="width: 45px; height: 45px; background: rgba(255,255,255,0.05); font-size: 1.2rem;">
                                        <i class="fas ${icons[b.category_id] || 'fa-tag'}"></i>
                                    </div>
                                    <div>
                                        <h6 class="fw-bold mb-1 text-white">${catName}</h6>
                                        <small class="text-secondary" style="font-size: 0.75rem;">
                                            –ê—è“õ—Ç–∞–ª–∞–¥—ã: ${b.end_date.split('T')[0]}
                                        </small>
                                    </div>
                                </div>
                                <i class="fas ${statusIcon} ${statusColor} fs-4"></i>
                            </div>

                            <div class="d-flex justify-content-between text-white-50 small mb-2">
                                <span>–ñ“±–º—Å–∞–ª–¥—ã: <b class="text-white">${spent.toLocaleString()} ‚Ç∏</b></span>
                                <span>–õ–∏–º–∏—Ç: ${limit.toLocaleString()} ‚Ç∏</span>
                            </div>

                            <div class="progress mb-2" style="height: 6px; background: #334155;">
                                <div class="progress-bar" role="progressbar" 
                                     style="width: ${percent}%; background-color: ${progressColor}; border-radius: 10px;">
                                </div>
                            </div>

                            <div class="d-flex justify-content-between small">
                                <span class="text-secondary">${Math.round(percent)}% “õ–æ–ª–¥–∞–Ω—ã–ª–¥—ã</span>
                                <span class="${remainingColor} fw-bold">
                                    ${remaining < 0 ? '–ê—Å—ã–ø –∫–µ—Ç—Ç—ñ: ' : '“ö–∞–ª–¥—ã: '} 
                                    ${Math.abs(remaining).toLocaleString()} ‚Ç∏
                                </span>
                            </div>
                        </div>`;
                });

            } catch (e) {
                console.error(e);
                alert("–ë—é–¥–∂–µ—Ç—Ç—ñ –∂“Ø–∫—Ç–µ—É –∫–µ–∑—ñ–Ω–¥–µ “õ–∞—Ç–µ —à—ã“õ—Ç—ã!");
            }
        }
        // --- –î–ò–ê–ì–†–ê–ú–ú–ê –°–´–ó–ê–¢–´–ù –§–£–ù–ö–¶–ò–Ø–õ–ê–† (–ú–´–ù–ê–£ –ñ–ï–¢–Ü–°–ü–ï–ô –¢“∞–†) ---

    // –ì–ª–æ–±–∞–ª–¥—ã –∞–π–Ω—ã–º–∞–ª—ã–ª–∞—Ä (–µ—Å–∫—ñ –≥—Ä–∞—Ñ–∏–∫—Ç–µ—Ä–¥—ñ ”©—à—ñ—Ä—É “Ø—à—ñ–Ω –∫–µ—Ä–µ–∫)
    let myChartInstance = null;
    let doughnutInstance = null;

    // 1. –î”©“£–≥–µ–ª–µ–∫ –≥—Ä–∞—Ñ–∏–∫ (Doughnut Chart)
   // --- 1. –§–ò–õ–¨–¢–† –§–£–ù–ö–¶–ò–Ø–°–´ (–¢“Æ–ó–ï–¢–Ü–õ–ì–ï–ù –ù“∞–°“ö–ê) ---
    function applyFilter(period) {
        // 1. –ë–ê–¢–´–†–ú–ê–ù–´“¢ –¢“Æ–°–Ü–ù ”®–ó–ì–ï–†–¢–£ (–û–°–´ –ñ–ï–†–î–Ü –ñ”®–ù–î–ï–î–Ü–ú)
        // –ë–∞—Ä–ª—ã“õ –±–∞—Ç—ã—Ä–º–∞–ª–∞—Ä–¥–∞–Ω 'active' –∞–ª—ã–ø —Ç–∞—Å—Ç–∞–π–º—ã–∑
        const buttons = document.querySelectorAll('.filter-chip, .filter-btn');
        buttons.forEach(btn => btn.classList.remove('active'));

        // –ë–∞—Å—ã–ª“ì–∞–Ω –±–∞—Ç—ã—Ä–º–∞–Ω—ã —ñ–∑–¥–µ–π–º—ñ–∑ (–ï–∫—ñ –≤–∞—Ä–∏–∞–Ω—Ç–ø–µ–Ω)
        let btn = document.getElementById('filter-' + period);
        if (!btn) {
            btn = document.getElementById('btn-filter-' + period);
        }
        
        // –¢–∞–±—ã–ª—Å–∞, —Ç“Ø—Å—ñ–Ω “õ–æ—Å–∞–º—ã–∑
        if (btn) {
            btn.classList.add('active');
        }

        // 2. –£–ê“ö–´–¢–¢–´ –ê–õ–£
        const today = new Date();
        today.setHours(0, 0, 0, 0);

        // 3. –î–ï–†–ï–ö–¢–ï–†–î–Ü –°“Æ–ó–£
        let filtered = allTransactions.filter(item => {
            const dParts = item.date.split('T')[0].split('-');
            const txDate = new Date(dParts[0], dParts[1] - 1, dParts[2]); 
            txDate.setHours(0, 0, 0, 0);

            if (period === 'all') return true;
            if (period === 'today') return txDate.getTime() === today.getTime();
            if (period === 'week') { const w = new Date(today); w.setDate(today.getDate() - 7); return txDate >= w; }
            if (period === 'month') { const m = new Date(today.getFullYear(), today.getMonth(), 1); return txDate >= m; }
            if (period === '3months') { const m3 = new Date(today); m3.setMonth(today.getMonth() - 3); return txDate >= m3; }
            if (period === '6months') { const m6 = new Date(today); m6.setMonth(today.getMonth() - 6); return txDate >= m6; }
            return true;
        });

        // 4. –¢–Ü–ó–Ü–ú–î–Ü –ñ–ê“¢–ê–†–¢–£
        renderListOnly(filtered);

        // 5. –î–ï–†–ï–ö–¢–ï–†–î–Ü –ñ–ò–ù–ê–£
        let totalInc = 0, totalExp = 0;
        const catMap = {}; 
        const dateMap = {}; 

        filtered.forEach(i => {
            if (i.type === 'inc') totalInc += i.amount;
            else {
                totalExp += i.amount;
                const cName = catNames[i.category_id] || '–ë–∞—Å“õ–∞';
                catMap[cName] = (catMap[cName] || 0) + i.amount;
            }
            
            const dKey = i.date.split('T')[0];
            if(!dateMap[dKey]) dateMap[dKey] = {inc:0, exp:0};
            
            if(i.type==='inc') dateMap[dKey].inc += i.amount; 
            else dateMap[dKey].exp += i.amount;
        });

        // 6. –°–ê–ù–î–ê–†–î–´ –ñ–ê“¢–ê–†–¢–£ (ID-–ª–µ—Ä–¥—ñ —Ç–µ–∫—Å–µ—Ä—ñ–ø –∞–ª–∞–º—ã–∑)
        const elInc = document.getElementById("total-inc") || document.getElementById("total-income");
        const elExp = document.getElementById("total-exp") || document.getElementById("total-expenses");
        const elBal = document.getElementById("net-bal") || document.getElementById("net-balance");

        if(elInc) elInc.innerText = totalInc.toLocaleString() + " ‚Ç∏";
        if(elExp) elExp.innerText = totalExp.toLocaleString() + " ‚Ç∏";
        if(elBal) elBal.innerText = (totalInc - totalExp).toLocaleString() + " ‚Ç∏";

        // 7. –ì–†–ê–§–ò–ö–¢–ï–†–î–Ü –°–´–ó–£
        const sortedDates = Object.keys(dateMap).sort();
        const dataInc = sortedDates.map(d => dateMap[d].inc);
        const dataExp = sortedDates.map(d => dateMap[d].exp);
        const dData = Object.keys(catMap).map(k => ({category_name: k, total_amount: catMap[k]}));

        setTimeout(() => {
            if (typeof drawTrendChart === "function") drawTrendChart(sortedDates, dataInc, dataExp);
            if (typeof drawDoughnut === "function") drawDoughnut(dData);
        }, 50);
    }

    // --- 2. –ì–†–ê–§–ò–ö –°–´–ó–£ –§–£–ù–ö–¶–ò–Ø–õ–ê–†–´ ---
        

    // A) –ë–∞“ì–∞–Ω–¥—ã –≥—Ä–∞—Ñ–∏–∫ (–ö“Ø–Ω–¥–µ—Ä—ñ –±–∞—Ä)
    // A) –ë–∞“ì–∞–Ω–¥—ã –≥—Ä–∞—Ñ–∏–∫ (–°–Ü–ó “ö–ê–õ–ê“í–ê–ù–î–ê–ô: –ú–ê–ö–°–ò–ú–£–ú–î–´ –ñ–ê–õ–ü–´ –°–û–ú–ê“í–ê –¢–ï“¢–ï–°–¢–Ü–†–£)
    function drawTrendChart(labels, dataInc, dataExp) {
        const ctx = document.getElementById('barChart');
        if (!ctx) return;

        if (myChartInstance) myChartInstance.destroy();

        // –ï“£ “Ø–ª–∫–µ–Ω –∂–∞–ª–ø—ã —Å–æ–º–∞–Ω—ã —Ç–∞–±–∞–º—ã–∑ (–ö—ñ—Ä—ñ—Å –Ω–µ–º–µ—Å–µ –®—ã“ì—ã—Å)
        const maxTotal = Math.max(
            dataInc.reduce((a, b) => a + b, 0), 
            dataExp.reduce((a, b) => a + b, 0)
        );

        myChartInstance = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [
                    { label: '–ö—ñ—Ä—ñ—Å', data: dataInc, backgroundColor: '#10b981', borderRadius: 5, barPercentage: 0.6 },
                    { label: '–®—ã“ì—ã—Å', data: dataExp, backgroundColor: '#ef4444', borderRadius: 5, barPercentage: 0.6 }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    x: { grid: { display: false }, ticks: { color: '#94a3b8' } },
                    y: { 
                        beginAtZero: true, 
                        grid: { color: '#374151' }, 
                        ticks: { color: '#ffffff' },
                        // –ú–´–ù–ê –ñ–ï–†–î–Ü ”®–ó–ì–ï–†–¢–¢–Ü–ú:
                        // –ï–Ω–¥—ñ –≥—Ä–∞—Ñ–∏–∫ —à–∫–∞–ª–∞—Å—ã –∂–∞–ª–ø—ã —Å–æ–º–∞“ì–∞ –¥–µ–π—ñ–Ω —Å–æ–∑—ã–ª–∞–¥—ã
                        suggestedMax: maxTotal 
                    }
                }
            }
        });
    }

    // B) –î”©“£–≥–µ–ª–µ–∫ –≥—Ä–∞—Ñ–∏–∫
    function drawDoughnut(data) {
        const ctx = document.getElementById('doughnutChart');
        if (!ctx) return;

        if (doughnutInstance) doughnutInstance.destroy();

        let labels = [], values = [], colors = ['#334155'];
        
        // –î–µ—Ä–µ–∫—Ç–µ—Ä–¥—ñ –¥“±—Ä—ã—Å –æ“õ—É
        if (Array.isArray(data) && data.length > 0) {
            labels = data.map(d => d.category_name);
            values = data.map(d => d.total_amount);
            colors = ['#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6', '#ec4899'];
        } else {
            labels = ['–î–µ—Ä–µ–∫ –∂–æ“õ']; values = [1];
        }

        doughnutInstance = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: labels,
                datasets: [{
                    data: values,
                    backgroundColor: colors,
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { position: 'right', labels: { color: 'white', boxWidth: 10 } } }
            }
        });
    }
    // 1. –ú–æ–¥–∞–ª—å–¥—ã –∞—à—É —Ñ—É–Ω–∫—Ü–∏—è—Å—ã
function openProfileModal() {
    // –ê—Ç—ã –º–µ–Ω –ø–æ—á—Ç–∞–Ω—ã header-–¥–µ–Ω –∞–ª—ã–ø, –º–æ–¥–∞–ª—å“ì–∞ “õ–æ—è–º—ã–∑
    const nameText = document.getElementById("header-user-name")?.innerText || "User";
    const emailText = document.getElementById("header-user-email")?.innerText || "...";
    
    document.getElementById("profile-name").innerText = nameText;
    document.getElementById("profile-email").innerText = emailText;
    
    // –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —Å–∞–Ω—ã–Ω —Å–∞–Ω–∞–ø “õ–æ—é (”ô–¥–µ–º—ñ–ª—ñ–∫ “Ø—à—ñ–Ω)
    document.getElementById("profile-tx-count").innerText = allTransactions.length;

    // –¢–µ—Ä–µ–∑–µ–Ω—ñ –∞—à—É
    new bootstrap.Modal(document.getElementById('profileModal')).show();
}

// 2. showApp() —Ñ—É–Ω–∫—Ü–∏—è—Å—ã–Ω—ã“£ —ñ—à—ñ–Ω–¥–µ–≥—ñ user-name ID-–ª–∞—Ä—ã–Ω –¥“±—Ä—ã—Å—Ç–∞—É
// (–°–µ–±–µ–±—ñ –º–µ–Ω HTML-–¥–µ ID-–ª–∞—Ä–¥—ã "header-user-name" –¥–µ–ø ”©–∑–≥–µ—Ä—Ç—Ç—ñ–º, —à–∞—Ç–∞—Å–ø–∞—É “Ø—à—ñ–Ω)
function showApp() {
    document.getElementById('auth-screen').style.display='none';
    document.getElementById('app-screen').style.display='block';
    loadData();
    loadBudgets();
    
    fetch(`${API_URL}/users/me/`, { headers: {"Authorization": `Bearer ${token}`} })
        .then(r => r.json())
        .then(u => {
            // Header-–¥–µ–≥—ñ –∂–∞–∑—É–ª–∞—Ä–¥—ã –∂–∞“£–∞—Ä—Ç—É
            if(document.getElementById("header-user-name")) 
                document.getElementById("header-user-name").innerText = u.username;
            if(document.getElementById("header-user-email")) 
                document.getElementById("header-user-email").innerText = u.email;
        });
}
// --- –ü–†–û–§–ò–õ–¨–î–Ü ”®–ó–ì–ï–†–¢–£ –õ–û–ì–ò–ö–ê–°–´ ---
    let isEditing = false;

    // 1. ”®“£–¥–µ—É —Ä–µ–∂–∏–º—ñ–Ω “õ–æ—Å—É/”©—à—ñ—Ä—É (“ö–∞–ª–∞–º–¥—ã –±–∞—Å“õ–∞–Ω–¥–∞)
    function toggleEditMode() {
        isEditing = !isEditing;
        
        if (isEditing) {
            // –§–æ—Ä–º–∞–Ω—ã –∫”©—Ä—Å–µ—Ç–µ–º—ñ–∑, –∂–∞–π –∂–∞–∑—É–¥—ã –∂–∞—Å—ã—Ä–∞–º—ã–∑
            document.getElementById('view-mode').style.display = 'none';
            document.getElementById('edit-mode').style.display = 'block';
            
            // “ö–∞–∑—ñ—Ä–≥—ñ –∞—Ç—ã–Ω input-“õ–∞ –∂–∞–∑—ã–ø “õ–æ—è–º—ã–∑
            document.getElementById('edit-username').value = document.getElementById('profile-name').innerText;
            document.getElementById('edit-email').value = document.getElementById('profile-email').innerText;
        } else {
            // –ö–µ—Ä—ñ—Å—ñ–Ω—à–µ
            document.getElementById('view-mode').style.display = 'block';
            document.getElementById('edit-mode').style.display = 'none';
        }
    }

    // 2. ”®–∑–≥–µ—Ä—ñ—Å—Ç–µ—Ä–¥—ñ —Å–∞“õ—Ç–∞—É (Simulation)
    function saveProfileChanges() {
        const newName = document.getElementById('edit-username').value;
        const newEmail = document.getElementById('edit-email').value;

        if(!newName || !newEmail) return alert("”®—Ä—ñ—Å—Ç–µ—Ä–¥—ñ —Ç–æ–ª—Ç—ã—Ä—ã“£—ã–∑!");

        // –ë“±–ª –∂–µ—Ä–¥–µ —Å–µ—Ä–≤–µ—Ä–≥–µ —Å“±—Ä–∞–Ω—ã—Å –∫–µ—Ç—É –∫–µ—Ä–µ–∫. 
        // ”ò–∑—ñ—Ä–≥–µ —Ç–µ–∫ —ç–∫—Ä–∞–Ω–¥–∞ ”©–∑–≥–µ—Ä—Ç–µ–º—ñ–∑:
        
        document.getElementById('profile-name').innerText = newName;
        document.getElementById('profile-email').innerText = newEmail;
        
        // Header-–¥–µ–≥—ñ (–∂–æ“ì–∞—Ä“ì—ã —Å–æ–ª –∂–∞“õ) –∞—Ç—ã–Ω –¥–∞ ”©–∑–≥–µ—Ä—Ç–µ–º—ñ–∑
        if(document.getElementById('header-user-name')) {
            document.getElementById('header-user-name').innerText = newName;
        }
        if(document.getElementById('header-user-email')) {
            document.getElementById('header-user-email').innerText = newEmail;
        }

        alert("–ü—Ä–æ—Ñ–∏–ª—å —Å”ô—Ç—Ç—ñ –∂–∞“£–∞—Ä—Ç—ã–ª–¥—ã!");
        toggleEditMode(); // –†–µ–∂–∏–º–¥—ñ –∂–∞–±—É
    }
    
// --- –ü–†–û–§–ò–õ–¨ –§–£–ù–ö–¶–ò–Ø–õ–ê–†–´ ---

// 1. –ê–∫–∫–∞—É–Ω—Ç—Ç—ã ”©—à—ñ—Ä—É —Ñ—É–Ω–∫—Ü–∏—è—Å—ã (–°–∏–º—É–ª—è—Ü–∏—è)
function deleteAccount() {
    if(confirm("–°—ñ–∑ —à—ã–Ω—ã–º–µ–Ω –∞–∫–∫–∞—É–Ω—Ç—ã“£—ã–∑–¥—ã –∂”ô–Ω–µ –±–∞—Ä–ª—ã“õ –¥–µ—Ä–µ–∫—Ç–µ—Ä–¥—ñ ”©—à—ñ—Ä–≥—ñ“£—ñ–∑ –∫–µ–ª–µ –º–µ? –ë“±–ª ”ô—Ä–µ–∫–µ—Ç—Ç—ñ “õ–∞–π—Ç–∞—Ä—É –º“Ø–º–∫—ñ–Ω –µ–º–µ—Å!")) {
        alert("–ê–∫–∫–∞—É–Ω—Ç ”©—à—ñ—Ä—ñ–ª—É–¥–µ...");
        // –ë“±–ª –∂–µ—Ä–¥–µ —Å–µ—Ä–≤–µ—Ä–≥–µ DELETE —Å“±—Ä–∞–Ω—ã—Å—ã –∫–µ—Ç—É—ñ –∫–µ—Ä–µ–∫ –µ–¥—ñ
        // fetch('/users/me', { method: 'DELETE' ... })
        
        setTimeout(() => {
            alert("–ê–∫–∫–∞—É–Ω—Ç —Å”ô—Ç—Ç—ñ ”©—à—ñ—Ä—ñ–ª–¥—ñ.");
            logout(); // –®—ã“ì–∞—Ä—ã–ø –∂—ñ–±–µ—Ä–µ–º—ñ–∑
        }, 1000);
    }
}

// 2. ”®“£–¥–µ—É —Ä–µ–∂–∏–º—ñ (–ê–ª–¥—ã“£“ì—ã –∫–æ–¥ “õ–∞–ª–¥—ã)
function toggleEditMode() {
    isEditing = !isEditing;
    if (isEditing) {
        document.getElementById('view-mode').style.display = 'none';
        document.getElementById('edit-mode').style.display = 'block';
        document.getElementById('edit-username').value = document.getElementById('profile-name').innerText;
        document.getElementById('edit-email').value = document.getElementById('profile-email').innerText;
    } else {
        document.getElementById('view-mode').style.display = 'block';
        document.getElementById('edit-mode').style.display = 'none';
    }
}

function saveProfileChanges() {
    const newName = document.getElementById('edit-username').value;
    const newEmail = document.getElementById('edit-email').value;
    if(!newName || !newEmail) return alert("–¢–æ–ª—ã“õ —Ç–æ–ª—Ç—ã—Ä—ã“£—ã–∑!");
    
    document.getElementById('profile-name').innerText = newName;
    document.getElementById('profile-email').innerText = newEmail;
    
    // Header-–¥—ñ –¥–µ –∂–∞“£–∞—Ä—Ç—É
    if(document.getElementById('header-user-name')) document.getElementById('header-user-name').innerText = newName;
    
    alert("–°–∞“õ—Ç–∞–ª–¥—ã!");
    toggleEditMode();
}
// --- 1. –ü–ê–†–û–õ–¨–î–Ü ”®–ó–ì–ï–†–¢–£ –õ–û–ì–ò–ö–ê–°–´ ---
// --- 1. –ü–†–û–§–ò–õ–¨–î–Ü (–õ–û–ì–ò–ù/–ê–¢–´–ù) ”®–ó–ì–ï–†–¢–£ ---

function toggleEditMode() {
    isEditing = !isEditing;
    if (isEditing) {
        // –§–æ—Ä–º–∞–Ω—ã –∞—à—É –∂”ô–Ω–µ –º”ô–Ω–¥–µ—Ä–¥—ñ —Ç–æ–ª—Ç—ã—Ä—É
        document.getElementById('view-mode').style.display = 'none';
        document.getElementById('edit-mode').style.display = 'block';
        document.getElementById('edit-username').value = document.getElementById('profile-name').innerText;
        document.getElementById('edit-email').value = document.getElementById('profile-email').innerText;
    } else {
        document.getElementById('view-mode').style.display = 'block';
        document.getElementById('edit-mode').style.display = 'none';
    }
}

async function saveProfileChanges() {
    const newName = document.getElementById('edit-username').value;
    const newEmail = document.getElementById('edit-email').value;

    if(!newName || !newEmail) return showToast("”®—Ä—ñ—Å—Ç–µ—Ä–¥—ñ —Ç–æ–ª—Ç—ã—Ä—ã“£—ã–∑!", "error");

    try {
        // –°–µ—Ä–≤–µ—Ä–≥–µ –∂—ñ–±–µ—Ä—É (PUT /users/me)
        const res = await fetch(`${API_URL}/users/me`, { 
            method: 'PUT',
            headers: { 
                "Authorization": `Bearer ${token}`, 
                "Content-Type": "application/json" 
            },
            body: JSON.stringify({ 
                username: newName,
                email: newEmail
            })
        });

        if (res.ok) {
            // –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—Ç—ñ –∂–∞“£–∞—Ä—Ç—É
            document.getElementById('profile-name').innerText = newName;
            document.getElementById('profile-email').innerText = newEmail;
            
            // Header-–¥–µ–≥—ñ –∂–∞–∑—É–¥—ã –¥–∞ ”©–∑–≥–µ—Ä—Ç—É
            if(document.getElementById('header-user-name')) document.getElementById('header-user-name').innerText = newName;
            if(document.getElementById('header-user-email')) document.getElementById('header-user-email').innerText = newEmail;

            showToast("–ü—Ä–æ—Ñ–∏–ª—å —Å”ô—Ç—Ç—ñ –∂–∞“£–∞—Ä—Ç—ã–ª–¥—ã!");
            toggleEditMode(); // –†–µ–∂–∏–º–¥—ñ –∂–∞–±—É
        } else {
            const err = await res.json();
            showToast(err.detail || "“ö–∞—Ç–µ —à—ã“õ—Ç—ã!", "error");
        }
    } catch (e) {
        console.error(e);
        showToast("–°–µ—Ä–≤–µ—Ä–º–µ–Ω –±–∞–π–ª–∞–Ω—ã—Å –∂–æ“õ (–ü—Ä–æ—Ñ–∏–ª—å)!", "error");
    }
}

// --- 2. –ü–ê–†–û–õ–¨–î–Ü ”®–ó–ì–ï–†–¢–£ ---
function togglePasswordForm() {
    const form = document.getElementById('password-form');
    const btn = document.getElementById('btn-change-pass');
    
    if (form.style.display === 'none') {
        form.style.display = 'block';
        btn.style.display = 'none'; 
    } else {
        form.style.display = 'none';
        btn.style.display = 'block'; 
    }
}

async function saveNewPassword() {
    const oldPass = document.getElementById('old-pass').value;
    const newPass = document.getElementById('new-pass').value;
    const confirmPass = document.getElementById('confirm-pass').value;

    if (!oldPass || !newPass) return showToast("–ë–∞—Ä–ª—ã“õ ”©—Ä—ñ—Å—Ç—ñ —Ç–æ–ª—Ç—ã—Ä—ã“£—ã–∑!", "error");
    if (newPass !== confirmPass) return showToast("–ñ–∞“£–∞ –ø–∞—Ä–æ–ª—å–¥–µ—Ä —Å”ô–π–∫–µ—Å –µ–º–µ—Å!", "error");

    try {
        const btn = document.querySelector('#password-form button');
        const originalText = btn.innerText;
        btn.innerText = "–ñ—ñ–±–µ—Ä—ñ–ª—É–¥–µ...";
        btn.disabled = true;

        const res = await fetch(`${API_URL}/users/password`, { 
            method: 'PUT', 
            headers: { 
                "Authorization": `Bearer ${token}`, 
                "Content-Type": "application/json" 
            },
            body: JSON.stringify({ 
                old_password: oldPass,
                new_password: newPass 
            })
        });

        if (res.ok) {
            showToast("–ü–∞—Ä–æ–ª—å —Å”ô—Ç—Ç—ñ ”©–∑–≥–µ—Ä—Ç—ñ–ª–¥—ñ!");
            document.getElementById('old-pass').value = "";
            document.getElementById('new-pass').value = "";
            document.getElementById('confirm-pass').value = "";
            togglePasswordForm(); 
        } else {
            const err = await res.json();
            showToast(err.detail || "–ï—Å–∫—ñ –ø–∞—Ä–æ–ª—å “õ–∞—Ç–µ –±–æ–ª—É—ã –º“Ø–º–∫—ñ–Ω!", "error");
        }
        btn.innerText = originalText;
        btn.disabled = false;

    } catch (e) {
        console.error(e);
        showToast("–°–µ—Ä–≤–µ—Ä–º–µ–Ω –±–∞–π–ª–∞–Ω—ã—Å –∂–æ“õ (–ü–∞—Ä–æ–ª—å)!", "error");
    }
}

// --- 4. –ê–ö–ö–ê–£–ù–¢–¢–´ ”®–®–Ü–†–£ (–®–´–ù–ê–ô–´) ---
async function deleteAccount() {
    // 1. –ï—Å–∫–µ—Ä—Ç—É (“ö–æ—Ä“ì–∞–Ω—ã—Å)
    if(!confirm("–°–Ü–ó –®–´–ù–´–ú–ï–ù –ê–ö–ö–ê–£–ù–¢–´“¢–´–ó–î–´ ”®–®–Ü–†–ì–Ü“¢–Ü–ó –ö–ï–õ–ï –ú–ï?\n\n–ë“±–ª ”ô—Ä–µ–∫–µ—Ç—Ç—ñ –∫–µ—Ä—ñ “õ–∞–π—Ç–∞—Ä—É –º“Ø–º–∫—ñ–Ω –µ–º–µ—Å! –ë–∞—Ä–ª—ã“õ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–ª–∞—Ä –∂–æ–π—ã–ª–∞–¥—ã.")) {
        return; // "–ñ–æ“õ" –¥–µ—Å–µ, —Ç–æ“õ—Ç–∞—Ç–∞–º—ã–∑
    }

    // 2. –°–µ—Ä–≤–µ—Ä–≥–µ —Å“±—Ä–∞–Ω—ã—Å –∂—ñ–±–µ—Ä—É
    try {
        const res = await fetch(`${API_URL}/users/me`, { 
            method: 'DELETE', // ”®—à—ñ—Ä—É –∫–æ–º–∞–Ω–¥–∞—Å—ã
            headers: { 
                "Authorization": `Bearer ${token}`
            }
        });

        if (res.ok) {
            // –°”ô—Ç—Ç—ñ ”©—à—Å–µ
            showToast("–ê–∫–∫–∞—É–Ω—Ç —Ç–æ–ª—ã“ì—ã–º–µ–Ω ”©—à—ñ—Ä—ñ–ª–¥—ñ!", "success");
            
            // 2 —Å–µ–∫—É–Ω–¥—Ç–∞–Ω —Å–æ“£ —à—ã“ì–∞—Ä—ã–ø –∂—ñ–±–µ—Ä–µ–º—ñ–∑
            setTimeout(() => {
                logout(); 
            }, 2000);
        } else {
            const err = await res.json();
            showToast(err.detail || "“ö–∞—Ç–µ —à—ã“õ—Ç—ã!", "error");
        }
    } catch (e) {
        console.error(e);
        showToast("–°–µ—Ä–≤–µ—Ä–º–µ–Ω –±–∞–π–ª–∞–Ω—ã—Å –∂–æ“õ!", "error");
    }
}   

// --- 3. –•–ê–ë–ê–†–õ–ê–ú–ê–õ–ê–† (TOAST SYSTEM) ---
function showToast(message, type = "success") {
    const toastEl = document.getElementById('liveToast');
    const toastBody = document.getElementById('toast-message');
    
    // –•–∞–±–∞—Ä–ª–∞–º–∞ –º”ô—Ç—ñ–Ω—ñ–Ω “õ–æ—é
    toastBody.innerText = message;
    
    // –¢“Ø—Å—ñ–Ω ”©–∑–≥–µ—Ä—Ç—É (–ñ–∞—Å—ã–ª - —Å”ô—Ç—Ç—ñ, “ö—ã–∑—ã–ª - “õ–∞—Ç–µ)
    if (type === "error") {
        toastEl.classList.remove('bg-success');
        toastEl.classList.add('bg-danger');
    } else {
        toastEl.classList.remove('bg-danger');
        toastEl.classList.add('bg-success');
    }

    // Bootstrap –∞—Ä“õ—ã–ª—ã –∫”©—Ä—Å–µ—Ç—É
    const toast = new bootstrap.Toast(toastEl);
    toast.show();
}
    </script>
</body>
</html>